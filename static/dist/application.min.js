!function(){"use strict";angular.element(document).ready(function(){console.log("Bootstraping the app"),angular.bootstrap(document.body,["baseApp"])}),angular.module("baseApp",["ngSanitize","ngStorage"],["$interpolateProvider",function(e){e.startSymbol("[["),e.endSymbol("]]")}]).config(["$httpProvider",function(e){e.defaults.headers.common={},e.defaults.headers.post={},e.defaults.headers.put={},e.defaults.headers.patch={},e.defaults.useXDomain=!0,delete e.defaults.headers.common["X-Requested-With"]}])}();
var settings={menus:[{name:"Methods",url:"/method/",show:!0},{name:"Publications",url:"/publications/",show:!0},{name:"Service Applications",url:"/service-applications/",show:!0}],application:{name:"Land Cover Portal",url:"/home/"},footerLinks:[{name:"About",url:"https://servir.adpc.net/about/about-servir-mekong",show:!0},{name:"Tools",url:"https://servir.adpc.net/tools",show:!0},{name:"Geospatial Datasets",url:"https://servir.adpc.net/geospatial-datasets",show:!0},{name:"Resources and Publications",url:"https://servir.adpc.net/publications",show:!0},{name:"News",url:"https://servir.adpc.net/news",show:!0},{name:"Events",url:"https://servir.adpc.net/events",show:!0},{name:"Contact Us",url:"https://servir.adpc.net/about/contact-servir-mekong",show:!0},{name:"Privacy Policy",url:"#",show:!0}],partnersHeader:[{alt:"The United States Agency for International Development",url:"https://www.usaid.gov/",src:"images/usaid.png",className:"usaid",version1:!0},{alt:"The National Aeronautics and Space Administration",url:"https://www.nasa.gov/",src:"images/nasa.png",className:"nasa",version1:!0},{alt:"Asian Disaster Preparedness Center",url:"http://www.adpc.net/",src:"images/adpc.png",className:"adpc",version1:!0},{alt:"ICIMOD",url:"http://www.icimod.org/",src:"images/icimod.png",className:"icimod",version1:!1},{alt:"SERVIR-HKH",url:"http://servir.icimod.org/",src:"images/servir-himalaya.png",className:"servir-hkh",version1:!1},{alt:"SERVIR-Mekong",url:"https://servir.adpc.net/",src:"images/servir-mekong.png",className:"servir",version1:!0}],partnersFooter:[{alt:"Spatial Infomatics Group",url:"https://sig-gis.com/",src:"images/sig.png",className:"partner-sig"},{alt:"Stockholm Environment Institute",url:"https://www.sei-international.org/",src:"images/sei.png",className:"partner-sei"},{alt:"Deltares",url:"https://www.deltares.nl/en/",src:"images/deltares.png",className:"partner-deltares"}],areaIndexSelectors:[{value:"country",name:"Country Level"},{value:"province",name:"Administrative Level"}],fmsDataPurpose:[{value:"agriculture",name:"Agriculture"},{value:"climate_change",name:"Climate Change"},{value:"env",name:"Environment"},{value:"forest",name:"Forest"},{value:"biology",name:"Biology"},{value:"conservation",name:"Conservation"},{value:"others",name:"Others"}],countries:["Cambodia","Laos","Myanmar","Thailand","Vietnam"],provinces:["Amnat Charoen","An Giang","Ang Thong","Attapu","Ayeyarwady","Ba Ria - VTau","Bac Giang","Bac Kan","Bac Lieu","Bac Ninh","Bago","Bangkok Metropolis","Banteay Mean Cheay","Battambang","Ben Tre","Binh Dinh","Binh Duong","Binh Phuoc","Binh Thuan","Bokeo","Bolikhamxai","Bueng Kan","Buri Ram","Ca Mau","Can Tho","Cao Bang","Chachoengsao","Chai Nat","Chaiyaphum","Champasak","Chanthaburi","Chiang Mai","Chiang Rai","Chin","Chon Buri","Chumphon","Da Nang City","Dac Nong","Dak Lak","Dien Bien","Dong Nai","Dong Thap","Gia Lai","Ha Giang","Ha Nam","Ha Tay","Ha Tinh","Hai Duong","Haiphong","Hanoi","Hau Giang","Ho Chi Minh","Hoa Binh","Houaphan","Hung Yen","Kachin","Kalasin","Kamphaeng Nakhon Viang Chan","Kamphaeng Phet","Kampong Chaam","Kampong Speu","Kampong Thom","Kampot","Kanchanaburi","Kandaal","Kayah","Kayin","Keb","Khammouan","Khanh Hoa","Khon Kaen","Kien Giang","Koh Kong","Kompong Chnang","Kon Tum","Krabi","Kratie","Lai Chau","Lam Dong","Lampang","Lamphun","Lang Son","Lao Cai","Loei","Long An","Lop Buri","Louang Namtha","Louangphrabang","Mae Hong Son","Magway","Maha Sarakham","Mandalay","Mon","Mondul Kiri","Mukdahan","Nakhon Nayok","Nakhon Pathom","Nakhon Phanom","Nakhon Ratchasima","Nakhon Sawan","Nakhon Si Thammarat","Nam Dinh","Nan","Narathiwat","Naypyitaw","Nghe An","Ninh Binh","Ninh Thuan","Nong Bua Lam Phu","Nong Khai","Nonthaburi","Oddar Meanchey","Oudomxai","Pailin","Pathum Thani","Pattani","Phangnga","Phatthalung","Phayao","Phetchabun","Phetchaburi","Phichit","Phitsanulok","Phnum Penh","Phongsali","Phra Nakhon Si Ayutthaya","Phrae","Phu Tho","Phu Yen","Phuket","Prachin Buri","Prachuap Khiri Khan","Preah Vihear","Prey Veaeng","Pursat","Quang Binh","Quang Nam","Quang Ngai","Quang Ninh","Quang Tri","Rakhine","Ranong","Ratana Kiri","Ratchaburi","Rayong","Roi Et","Sa Kaeo","Sagaing","Sakon Nakhon","Samut Prakan","Samut Sakhon","Samut Songkhram","Saraburi","Saravan","Satun","Savannakhot","Shan","Si Sa Ket","Siem Reap","Sihanoukville","Sing Buri","Soairieng","Soc Trang","Son La","Songkhla","Stung Treng","Sukhothai","Suphan Buri","Surat Thani","Surin","Tak","Takeo","Tanintharyi","Tay Ninh","Tbong Khmum","Thai Binh","Thai Nguyen","Thanh Hoa","Thua Thien - Hue","Tien Giang","Tra Vinh","Trang","Trat","Tuyen Quang","Ubon Ratchathani","Udon Thani","Uthai Thani","Uttaradit","Vientiane","Vinh Long","Vinh Phuc","Xaignabouri","Xaisomboun","Xekong","Xiangkhoang","Yala","Yangon","Yasothon","Yen Bai"],myanmarProvinces:["Ayeyarwady","Bago","Chin","Kachin","Kayah","Kayin","Magway","Mandalay","Mon","Naypyitaw","Rakhine","Sagaing","Shan","Tanintharyi","Yangon"],landCoverClassesV1:[{name:"Unknown",value:"0",color:"#6f6f6f"},{name:"Surface Water",value:"1",color:"#aec3d4"},{name:"Snow and Ice",value:"2",color:"#b1f9ff"},{name:"Mangroves",value:"3",color:"#111149"},{name:"Flooded Forest",value:"4",color:"#287463"},{name:"Deciduous Forest",value:"5",color:"#152106"},{name:"Orchard or Plantation forest",value:"6",color:"#c3aa69"},{name:"Evergreen Broadleaf Alpine",value:"7",color:"#9ad2a5"},{name:"Evergreen Broadleaf",value:"8",color:"#7db087"},{name:"Evergreen Needleleaf",value:"9",color:"#486f50"},{name:"Evergreen Mixed Forest",value:"10",color:"#387242"},{name:"Mixed Evergreen and Deciduous",value:"11",color:"#115420"},{name:"Urban and Built Up",value:"12",color:"#cc0013"},{name:"Cropland",value:"13",color:"#8dc33b"},{name:"Rice Paddy",value:"14",color:"#ffff00"},{name:"Mudflat and Intertidal",value:"15",color:"#a1843b"},{name:"Mining",value:"16",color:"#cec2a5"},{name:"Barren",value:"17",color:"#674c06"},{name:"Wetlands",value:"18",color:"#3bc3b2"},{name:"Grassland",value:"19",color:"#f4a460"},{name:"Shrubland",value:"20",color:"#800080"}],landCoverClassesV2:[{name:"Unknown",value:"0",color:"#6f6f6f"},{name:"Surface Water",value:"1",color:"#aec3d4"},{name:"Snow and Ice",value:"2",color:"#b1f9ff"},{name:"Mangroves",value:"3",color:"#111149"},{name:"Flooded Forest",value:"4",color:"#287463"},{name:"Deciduous Forest",value:"5",color:"#152106"},{name:"Orchard or Plantation Forest",value:"6",color:"#c3aa69"},{name:"Evergreen Broadleaf",value:"7",color:"#7db087"},{name:"Mixed Forest",value:"8",color:"#387242"},{name:"Urban and Built Up",value:"9",color:"#cc0013"},{name:"Cropland",value:"10",color:"#8dc33b"},{name:"Rice",value:"11",color:"#ffff00"},{name:"Mining",value:"12",color:"#cec2a5"},{name:"Barren",value:"13",color:"#674c06"},{name:"Wetlands",value:"14",color:"#3bc3b2"},{name:"Grassland",value:"15",color:"#f4a460"},{name:"Shrubland",value:"16",color:"#800080"},{name:"Aquaculture",value:"17",color:"#51768e"}],landCoverClasses:[{name:"Unknown",value:"0",color:"#6f6f6f",caret:!1},{name:"Surface Water",value:"1",color:"#aec3d4",caret:!1},{name:"Snow and Ice",value:"2",color:"#b1f9ff",caret:!1},{name:"Mangroves",value:"3",color:"#111149",caret:!1},{name:"Flooded Forest",value:"4",color:"#287463",caret:!1},{name:"Forest",value:"5",color:"#152106",caret:!0},{name:"Orchard or Plantation Forest",value:"6",color:"#c3aa69",caret:!1},{name:"Evergreen Broadleaf",value:"7",color:"#7db087",nestedUnder:"5",caret:!1},{name:"Mixed Forest",value:"8",color:"#387242",nestedUnder:"5",caret:!1},{name:"Urban and Built Up",value:"9",color:"#cc0013",caret:!1},{name:"Cropland",value:"10",color:"#8dc33b",caret:!1},{name:"Rice",value:"11",color:"#ffff00",caret:!1},{name:"Mining",value:"12",color:"#cec2a5",caret:!1},{name:"Barren",value:"13",color:"#674c06",caret:!1},{name:"Wetlands",value:"14",color:"#3bc3b2",caret:!1},{name:"Grassland",value:"15",color:"#f4a460",caret:!1},{name:"Shrubland",value:"16",color:"#800080",caret:!1},{name:"Aquaculture",value:"17",color:"#51768e",caret:!1}],primitiveClassesV1:[{name:"Barren",value:"0"},{name:"Built up",value:"1"},{name:"Canopy",value:"2"},{name:"Cropland",value:"3"},{name:"Deciduous",value:"4"},{name:"Ephemeral Water",value:"5"},{name:"Evergreen",value:"6"},{name:"Evergreen Broadleaf",value:"7"},{name:"Evergreen Needleleaf",value:"8"},{name:"Grass",value:"9"},{name:"Impervious",value:"10"},{name:"Irrigated",value:"11"},{name:"Mangrove",value:"12"},{name:"Rice",value:"13"},{name:"Shrub",value:"14"},{name:"Snow Ice",value:"15"},{name:"Surface Water",value:"16"},{name:"Tree Height",value:"17"}],primitiveClasses:[{name:"Aquaculture",value:"0"},{name:"Barren",value:"1"},{name:"Closed Forest",value:"2"},{name:"Cropland",value:"3"},{name:"Deciduous",value:"4"},{name:"Evergreen",value:"5"},{name:"Flooded Forest",value:"6"},{name:"Grass",value:"7"},{name:"Mangrove",value:"8"},{name:"Mixed Forest",value:"9"},{name:"Open Forest",value:"10"},{name:"Plantations",value:"11"},{name:"Rice",value:"12"},{name:"Shrub",value:"13"},{name:"Snow",value:"14"},{name:"Tidal",value:"15"},{name:"Urban",value:"16"},{name:"Water",value:"17"},{name:"Wetlands",value:"18"},{name:"Woody",value:"19"}],myanmarNationalClasses:[{name:"Unknown",value:"0",color:"#6f6f6f"},{name:"Surface Water",value:"1",color:"#0000ff"},{name:"Snow and Ice",value:"2",color:"#808080"},{name:"Mangroves",value:"3",color:"#556b2f"},{name:"Cropland",value:"4",color:"#7cfc00"},{name:"Urban and Built up",value:"5",color:"#8b0000"},{name:"Grassland",value:"6",color:"#20b2aa"},{name:"Closed Forest",value:"7",color:"#006400"},{name:"Open Forest",value:"8",color:"#90ee90"},{name:"Wetland",value:"9",color:"#42f4c2"},{name:"Woody",value:"10",color:"#8b4513"},{name:"Other land",value:"11",color:"#6f6f6f"}],myanmarIPCCLandCoverClasses:[{name:"Forest",value:"0",color:"#006400"},{name:"Grassland",value:"1",color:"#20b2aa"},{name:"Cropland",value:"2",color:"#7cfc00"},{name:"Settlements",value:"3",color:"#8b0000"},{name:"Wetlands",value:"4",color:"#0000ff"},{name:"Other Lands",value:"5",color:"#6f6f6f"}],myanmarFRALandCoverClasses:[{name:"Water Bodies",value:"0",color:"#0000ff"},{name:"Forest",value:"1",color:"#006400"},{name:"Wooden Land",value:"2",color:"#8b4513"},{name:"Other Land",value:"3",color:"#6f6f6f"}],myanmarPrimitiveClasses:[{name:"Closed Forest",value:"0"},{name:"Cropland",value:"1"},{name:"Grass",value:"2"},{name:"Mangroves",value:"3"},{name:"Open Forest",value:"4"},{name:"Snow",value:"5"},{name:"Urban",value:"6"},{name:"Water",value:"7"},{name:"Wetlands",value:"8"},{name:"Woody",value:"9"}],myanmarPlantationClasses:[{name:"Unknown",value:"0",color:"#6f6f6f"},{name:"Surface water",value:"1",color:"#aec3d4"},{name:"Forest",value:"2",color:"#152106"},{name:"Urban and built up",value:"3",color:"#cc0013"},{name:"Cropland",value:"4",color:"#8dc33b"},{name:"Rubber",value:"5",color:"#3bc3b2"},{name:"Palmoil",value:"6",color:"#800080"},{name:"Mangrove",value:"7",color:"#111149"}],serviceApplicationsCards:[{name:"Regional Land Cover Monitoring System",description:"The regional land cover monitoring system provides a series of annual land cover maps with a multi-purpose typology for the period of 2000-2016 which includes:<br /><ul><li>Highly accurate, high quality regional land cover maps at a 30-meter resolution designed to serve explicit user-defined objectives.</li><li>Highly consistent maps over time, by using consistent regional classification scheme which harmonizes with land cover typologies from five Lower Mekong countries (22 land cover categories, which was identified through the regional consultative meeting).</li><li>Frequently updated (annual or bi annually) maps which leverage advantages of various open available remote sensing data sources.</li></ul>The purpose of this system is to facilitate the production of custom, high-quality land cover information products to serve a variety of policy, planning, management, and reporting needs of regional and national institutions in the Lower Mekong Region. The system leverages the power of Google Earth Engine and relies in most cases on field observations and the interpretation of high resolution imagery by stakeholders relevant to a given project.<br /> Once the system has been customized to deliver a given product or set of products, these can be updated regularly in a structured manner to serve ongoing monitoring needs.",url:"/landcover/",imageURL:"images/rlcms.png"},{name:"Forest Monitoring System",description:"The forest monitoring system is product of collaboration between SERVIR-Mekong and the Global Land Analysis and Discovery Lab (GLAD) from University of Maryland.<br />The tool allows users to view and download annual tree canopy cover percentage, annual tree height, ability to access annual forest extent by customizing country’s forest definition. Users can also perform calculations of forest dynamic which includes forest gain and loss by customizing forest definition and the change period.",url:"/forest-monitor/",imageURL:"images/fms.png"},{name:"Myanmar National Land Cover Portal",description:"SERVIR-Mekong and partners are collaborating and supporting the Forest Department of Myanmar to improve the forest monitoring system of Myanmar, which contributes for Myanmar National Forest Resources Assessment (FRA) to FAO. <br />The RLCMS is customized to meet the forest types definition in Myanmar. The product of this application are forest maps with forest categories and sub categories. Forest map products are from 2000 to 2016. The uncertainty and accuracy data assessment is integrated in the assemblage and map results.",url:"/myanmar-national-portal/",imageURL:"images/myanmar-national-portal.png"},{name:"Myanmar National Classification",description:"SERVIR-Mekong and partners are collaborating and supporting the Forest Department of Myanmar to improve the land cover monitoring system of Myanmar, which contributes for sustainable land use management. <br/>The national land cover product comprises of 11 classes (namely, Closed Forest, Opened Forest, Other Wooded Land, Mangroves, Wetlands, Snow and Ice, Cropland, Built up, Grassland, Surface Water and Others) and is produced annually. These national land cover products are the primary datasets required for reporting at national level and to FRA and UNFCCC.",url:"/myanmar-national/",imageURL:"images/myanmar-national.png"},{name:"Myanmar National IPCC",description:"SERVIR-Mekong and partners are collaborating and supporting the Forest Department of Myanmar to improve the land cover monitoring system which contributes for greenhouse gas emission inventory, climate change monitoring and reporting to the United Nations Climate Change (UNFCCC) by the government of Myanmar. <br />This customized product is a robust and sustainable national land cover monitoring system which can produce accurate LULC baseline datasets, and be updated annually for Myanmar's contribution to UNFCCC report.<br />Products of this application are annual land cover maps with 6 IPCC typologies classes (includes: Forest land, cropland, grassland, wetland) from 2000 to 2016. Activity data of 6 land cover categories will also be calculated in this application at different administrative levels.",url:"/myanmar-ipcc/",imageURL:"images/myanmar-ipcc.png"},{name:"Myanmar National FRA",description:"SERVIR-Mekong and partners are collaborating and supporting the Forest Department of Myanmar to improve the forest monitoring system of Myanmar, which contributes for Myanmar National Forest Resources Assessment (FRA) to FAO. <br />The RLCMS is customized to meet the forest types definition in Myanmar. The product of this application are forest maps with forest categories and sub categories. Forest map products are from 2000 to 2016. The uncertainty and accuracy data assessment is integrated in the assemblage and map results.",url:"/myanmar-fra/",imageURL:"images/myanmar-fra.png"},{name:"Myanmar Plantations Mapping",description:'The Dawna Tenasserim Landscape covers Kayin and Mon States, and Tanintharyi Region in Myanmar. The area harbours one of the last large intact forest landscapes in the region, which hosts a large number of ethnic groups, and a wide variety of endangered wildlife such as elephants and tigers. The region is experiencing numerous threats including rapid increase in agricultural land use and associated deforestation, notably for rubber and palm oil, road and infrastructure development, and logging resulting in habitat degradation and fragmentation. The Dawna Tenasserim plantation portal shows areas with cropland, rubber, palmoil for 2017 and 2018. <br><i> Remote Sens. 2019, 11(7), 831; <a href="https://doi.org/10.3390/rs11070831">https://doi.org/10.3390/rs11070831</a> </i>',url:"/myanmar-plantation/",imageURL:"images/plantation-mapping.jpg"},{name:"State of Land Report (Under Development)",description:"The Mekong region State of Land report is the application of customizing RLCMS, and a response to request from The Mekong Region Land Governance Project (MRLG), funded by the Swiss Agency for Development and Cooperation (SDC) and other partners. The 2018 State of Land will serve as a benchmark of current conditions, and set a baseline for future measurement and reporting of progress in land governance in the Mekong region.<br />The MRLG project needs a comprehensive overview of land resources in Mekong region including Cambodia, Laos, Myanmar, Thailand and Viet Nam, and the IPCC typologies (6 classes including) are used as representations for these products. The customization of the RLCMS for 6 IPCC classes has been applied to selected primitive layers and data assemblage processes based on the IPCC typology definition (IPCC guidelines in 2006). Regional land cover maps in two dates from 2006 and 2015 are products of this application.",url:"https://code.earthengine.google.com/64330db9b75742d76777ce01fe131001",imageURL:"images/solr.png"}],publicationLists:[{title:"Annual continuous fields of woody vegetation structure in the Lower Mekong region from 2000‐2017 Landsat time-series",url:"/static/vendor/viewerjs/ViewerJS/index.html#../../../publications/peter-et-al.pdf"},{title:"Primitives as building blocks for constructing land cover maps",url:"/static/vendor/viewerjs/ViewerJS/index.html#../../../publications/primitive-as-building-block.pdf"}]};angular.module("baseApp").constant("appSettings",settings);
!function(){"use strict";angular.module("baseApp").directive("textCollapse",["$compile",function(d){return{restrict:"A",scope:!0,link:function(i,g,r){i.collapsed=!1,i.toggle=function(){i.collapsed=!i.collapsed},r.$observe("textCollapseText",function(e){var n=i.$eval(r.textCollapseMaxLength);if(e.length>n){var l=String(e).substring(0,n),p=String(e).substring(n,e.length),a=d("<span>"+l+"</span>")(i),s=d('<span ng-if="collapsed">'+p+"</span>")(i),t=d('<span ng-if="!collapsed">... </span>')(i),o=d('<br ng-if="collapsed">')(i),c=d('<span class="collapse-text-toggle" ng-click="toggle()">[[collapsed ? "less" : "more"]]</span>')(i);g.empty(),g.append(a),g.append(s),g.append(t),g.append(o),g.append(c)}else g.empty(),g.append(e)})}}}])}();
!function(){"use strict";angular.module("baseApp").directive("validateEmail",function(){var e=/^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$/;return{require:"ngModel",restrict:"",link:function(a,t,i,r){r&&r.$validators.email&&(r.$validators.email=function(a){return r.$isEmpty(a)||e.test(a)})}}})}();
!function(){"use strict";angular.module("baseApp").controller("analysisController",["appSettings","$scope","$timeout","CommonService","LandCoverService","MapService",function(s,i,e,c,d,a){i.closeAlert=function(){$(".custom-alert").addClass("display-none"),i.alertContent=""};i.leftLayer=null,i.rightLayer=null,i.sideBySideControlInitialized=!1,i.showMapLoader=!1;var g=a.initLeafletMap("change-detection-map",{zoomControl:!1}),t=L.control.sideBySide();g.on("layeradd",function(){i.leftLayer&&i.rightLayer&&!i.sideBySideControlInitialized&&(t.setLeftLayers(i.leftLayer),t.setRightLayers(i.rightLayer),t.addTo(g),i.sideBySideControlInitialized=!0)});function r(e){void 0===e&&(e="both"),"left"===e?(g.removeLayer(i.leftLayer),i.leftLayer=null):"right"===e?(g.removeLayer(i.rightLayer),i.rightLayer=null):"both"===e&&(g.removeLayer(i.leftLayer),g.removeLayer(i.rightLayer),i.leftLayer=null,i.rightLayer=null),i.sideBySideControlInitialized=!1}i.getYearRange=function(e,a){i.yearRange=c.range(e,a),i.tableYear=i.yearRange[i.yearRange.length-1],i.pieYear=i.yearRange[i.yearRange.length-1],i.columnEndYear=i.yearRange[i.yearRange.length-1]};var o={"Satellite Imagery":a.getEsriWorldImageryLeafletLayer(),Grayscale:a.getMapBoxLeafletLayer(),"Topo Map":a.getEsriWorldTopoLeafletLayer()};L.control.layers(o,null,{position:"bottomleft"}).addTo(g),e(function(){L.Control.SelectLeftLayerControl=L.Control.extend({options:{position:"topleft",title:"Select the left layer for the map"},onAdd:function(e){var a=L.DomUtil.create("div","info"),t=L.DomUtil.create("select","form-control",a);t.style.boxShadow="0px 1px 5px rgba(0,0,0,0.4)";for(var r=0;r<i.yearRange.length;r++)t.options[r]=new Option(i.yearRange[r],i.yearRange[r]),i.yearRange[r]===i.leftLayerYear&&(t.options[r].selected=!0);return L.DomEvent.addListener(t,"change",this.onChange,this),a},onChange:function(e){var a=parseInt(e.currentTarget.value);i.leftLayerYear=a,r("left"),i.initMap(i.leftLayerYear,"left")}}),L.control.selectLeftLayerControl=function(e){return new L.Control.SelectLeftLayerControl(e)},L.control.selectLeftLayerControl({position:"topleft"}).addTo(g),L.Control.SelectRightLayerControl=L.Control.extend({options:{position:"topright",title:"Select the right layer for the map"},onAdd:function(e){var a=L.DomUtil.create("div","info"),t=L.DomUtil.create("select","form-control",a);t.style.boxShadow="0px 1px 5px rgba(0,0,0,0.4)";for(var r=0;r<i.yearRange.length;r++)t.options[r]=new Option(i.yearRange[r],i.yearRange[r]),i.yearRange[r]===i.rightLayerYear&&(t.options[r].selected=!0);return L.DomEvent.addListener(t,"change",this.onChange,this),a},onChange:function(e){var a=parseInt(e.currentTarget.value);i.rightLayerYear=a,r("right"),i.initMap(i.rightLayerYear,"right")}}),L.control.selectRightLayerControl=function(e){return new L.Control.SelectRightLayerControl(e)},L.control.selectRightLayerControl({position:"topright"}).addTo(g),L.Control.LegendControl=L.Control.extend({options:{position:"bottomright"},onAdd:function(e){for(var a=L.DomUtil.create("div","info-legend legend"),t=[],r=0;r<i.landCoverClasses.length;r++)t.push('<p><i style="background:'+i.landCoverClasses[r].color+'"></i> '+i.landCoverClasses[r].name+"</p>");return a.innerHTML=t.join("<br>"),a}}),L.control.legendControl=function(e){return new L.Control.LegendControl(e)},L.control.legendControl({position:"bottomright"}).addTo(g)}),L.control.zoom({position:"bottomright"}).addTo(g);i.areaIndexSelectors=s.areaIndexSelectors,i.areaSelectFrom=null,i.areaName=null,i.landCoverClasses=[],i.landCoverClassesColor={},i.initMap=function(e,r,a,t){if(i.showMapLoader=!0,"right"===r?i.rightLayerYear=e:"left"===r&&(i.leftLayerYear=e),void 0===t&&(t=!1),t&&c.isEmptyObject(i.landCoverClassesColor)&&0===i.landCoverClasses.length){"v1"===a?(i.landCoverClasses=s.landCoverClassesV1,i.getYearRange(2e3,2016)):"v2"===a?(i.landCoverClasses=s.landCoverClassesV2,i.getYearRange(2e3,2017)):(i.landCoverClasses=s.landCoverClasses,i.getYearRange(1987,2018)),i.assemblageLayers=[];for(var o=0;o<=i.landCoverClasses.length-1;o++)i.assemblageLayers.push(o.toString());i.landCoverClassesColor={};for(var n=0;n<i.landCoverClasses.length;n++)i.landCoverClassesColor[i.landCoverClasses[n].name]=i.landCoverClasses[n].color}var l={classes:i.assemblageLayers,year:e,version:a};d.getLandCoverMap(l).then(function(e){var a,t;t=e,i[(a=r)+"Layer"]=L.tileLayer("https://earthengine.googleapis.com/map/"+t.eeMapId+"/{z}/{x}/{y}?token="+t.eeMapToken),i[a+"Layer"].setZIndex(9999),i[a+"Layer"].addTo(g),i.showMapLoader=!1},function(e){var a;a=e.error,i.alertContent=a,$(".custom-alert").removeClass("display-none").removeClass("alert-info").removeClass("alert-success").addClass("alert-danger"),console.log(e)})},i.showSelectors=!1,i.populateSelectors=function(e){i.showSelectors=!0,i.areaSelectFrom=e.value,i.selectorOptions=c.getAreaVariableOptions(e.value)},i.loadSelectors=function(e){i.areaName=e},i.showtableLoader=!1,i.tableData=[];i.getTableStats=function(e){i.showtableLoader=!0;var a={classes:i.assemblageLayers,year:i.tableYear,areaSelectFrom:i.areaSelectFrom,areaName:i.areaName,version:e};d.getStats(a).then(function(e){for(var a in i.tableData=[],e){var t={name:a,area:e[a]};i.tableData.push(t)}!function(){for(var e=0,a=0;a<i.tableData.length;++a)e+=i.tableData[a].area;for(var t=0;t<i.tableData.length;++t)i.tableData[t].percentage=c.getPercent(i.tableData[t].area,e);i.showtableLoader=!1}()},function(e){console.log(e)})},i.changeTableYear=function(e,a){i.tableYear=e,i.getTableStats(a)},i.showPieLoader=!1,i.pieData=[],i.getPieStats=function(e){i.showPieLoader=!0;var a={classes:i.assemblageLayers,year:i.pieYear,areaSelectFrom:i.areaSelectFrom,areaName:i.areaName,version:e};d.getStats(a).then(function(e){var a=[];for(var t in e)a.push({name:t,y:2.471*e[t],color:i.landCoverClassesColor[t]});var r={data:a,div:"landcover-piechart",title:"",showDataLabels:!0,exportButtonPosition:"left",pointFormat:"{series.name}: <b>{point.percentage:.2f}%</b>",dataLabelFormat:"<b>{point.name}</b>: {point.percentage:.2f} %",seriesName:"Area (Acre)"};c.buildPieChart(r),i.showPieLoader=!1},function(e){console.log(e)})},i.changePieYear=function(e,a){i.pieYear=e,i.getPieStats(a)},i.showColumnLoader=!1,i.columnStartYear=2015,i.loadColumnStats=function(e){if(i.columnStartYear>=i.columnEndYear)alert("start year must be less than end year");else{i.showColumnLoader=!0;var n=c.range(i.columnStartYear,i.columnEndYear),a={classes:i.assemblageLayers,areaSelectFrom:i.areaSelectFrom,areaName:i.areaName,version:e};d.getColumnStatData(a,n).then(function(e){var t={};for(var a in i.landCoverClasses)t[i.landCoverClasses[a].name]={name:i.landCoverClasses[a].name,data:[],color:i.landCoverClasses[a].color};e.forEach(function(e){for(var a in e)c.objectHasKey(t,a)?t[a].data.push(e[a]):console.log(a+" not available!")});var r={categories:n,data:[],container:"landcover-column",yAxisTitle:"Area (Hectare)",toolTipUnit:"Hectare",dataLabels:!1};for(var o in t)r.data.push(t[o]);c.buildColumnChart(r),i.showColumnLoader=!1},function(e){console.log(e)})}}}])}();
!function(){"use strict";angular.module("baseApp").filter("treeCanopyHeightYearRange",function(){return function(e,o,t){o=parseInt(o),t=parseInt(t);for(var r=o;r<=t;r++)e.push(r);return e}}).controller("forestMonitorController",["$rootScope","$scope","$sanitize","$http","appSettings","CommonService","MapService","ForestMonitorService",function(e,c,i,t,o,n,d,s){var a=null,y=d.init();c.areaIndexSelectors=o.areaIndexSelectors,c.fmsDataPurpose=o.fmsDataPurpose,c.fmsUserDownloadInfo=s.getUserDownloadInfo(),c.overlays={},c.shape={},c.areaSelectFrom=null,c.areaName=null,c.shownGeoJson=null,c.showAreaVariableSelector=!1,c.alertContent="",c.toolControlClass="glyphicon glyphicon-eye-open",c.showTabContainer=!0,c.showLoader=!1,c.showReportNoPolygon=!0,c.showReportTotalArea=!1,c.showReportTreeCanopy=!1,c.showReportForestGain=!1,c.showReportForestLoss=!1,c.showReportForestExtend=!1,c.showReportPrimaryForest=!1,c.mapClass=n.mapClass,c.sideClass=n.sideClass,e.$broadcast("showToggleFullScreenIcon",{show:!0}),e.$on("toggleFullScreen",function(e,o){c.mapClass=o.mapClass,c.sideClass=o.sideClass,"col-md-12 col-lg-12"===o.mapClass?($(".custom-alert").css({"margin-left":"5%",width:"calc(100vw - 20%)"}),$(".slider-year-container").css({width:"85%"})):($(".custom-alert").css({"margin-left":"25.5%",width:"calc(100vw - 26%)"}),$(".slider-year-container").css({width:"60%"}))}),c.closeAlert=function(){$(".custom-alert").addClass("display-none"),c.alertContent=""};function u(e){c.alertContent=e,$(".custom-alert").removeClass("display-none").removeClass("alert-info").removeClass("alert-success").addClass("alert-danger")}function l(e){c.alertContent=e,$(".custom-alert").removeClass("display-none").removeClass("alert-info").removeClass("alert-danger").addClass("alert-success")}function h(e){c.alertContent=e,$(".custom-alert").removeClass("display-none").removeClass("alert-success").removeClass("alert-danger").addClass("alert-info")}function p(e,o,t){if(!(-1<["polygon","circle","rectangle"].indexOf(c.shape.type))&&!c.areaSelectFrom&&!c.areaName)return u("Please draw a polygon or select administrative region before proceding to download!"),!1;if(void 0===t&&(t=!1),t){if(e&&!o)return u("Please provide the end year!"),!1;if(!e&&o)return u("Please provide start year!"),!1;if(!e||!o)return u("Please select both start and end date!"),!1;if(Number(e)>=Number(o))return u("End year must be greater than start year!"),!1}return!0}c.showEmailID=!1,c.emailID="",c.googleSignIn=function(){auth2.grantOfflineAccess().then(function(e){if(e.code){var o={method:"POST",url:"/storeauthcode/",headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/octet-stream; charset=utf-8"},data:{authcode:e.code}};t(o).then(function(e){var o=e.data;o.success?(c.showEmailID=!0,c.emailID=o.email):u("there was an error while authenticating using google sign-in")}).catch(function(e){throw console.log("Error: ",e),e.data})}else u("there was an error while authenticating using google sign-in")})},c.googleSignOut=function(){gapi.auth2.getAuthInstance().signOut().then(function(){console.log("User signed out."),c.emailID="",c.showEmailID=!1,c.$apply()})},c.toggleToolControl=function(){$("#analysis-tool-control i").hasClass("fas fa-times")?($("#analysis-tool-control i").removeClass("fas fa-times").addClass("fas fa-chart-pie"),c.showTabContainer=!1):($("#analysis-tool-control i").removeClass("fas fa-chart-pie").addClass("fas fa-times"),c.showTabContainer=!0),c.$apply()};var r=document.getElementById("tool-control-container");new n.AnalysisToolControl(r).addEventListener("click",function(){c.toggleToolControl()}),y.controls[google.maps.ControlPosition.TOP_RIGHT].push(r),$(".btn-pref .btn").click(function(){$(".btn-pref .btn").removeClass("btn-primary").addClass("btn-default"),$(this).removeClass("btn-default").addClass("btn-primary")}),$(".btn-pref-inner .btn").click(function(){$(".btn-pref-inner .btn").removeClass("btn-primary").addClass("btn-default"),$(this).removeClass("btn-default").addClass("btn-primary")}),$(".js-tooltip").tooltip();$("#time-period-tab>#datepicker").datepicker({autoclose:!0,clearBtn:!0,container:".datepicker"}),$("a.layer-control-toggle").click(function(){$(this).find(".glyphicon").hasClass("glyphicon-plus")?($(this).find(".glyphicon").addClass("glyphicon-minus").removeClass("glyphicon-plus"),$(".layer-control").css({marginRight:"44%"})):($(this).find(".glyphicon").addClass("glyphicon-plus").removeClass("glyphicon-minus"),$(".layer-control").css({marginRight:"65%"}))}),c.populateAreaVariableOptions=function(e){c.showAreaVariableSelector=!0,c.areaSelectFrom=e.value,c.areaVariableOptions=n.getAreaVariableOptions(e.value)};function g(){c.showReportNoPolygon=!1,c.reportTotalAreaValue=(Math.round(100*a*100)/100).toLocaleString()+" ha",c.showReportTotalArea=!0,c.$apply()}function f(){c.areaSelectFrom="",c.areaIndexSelector="",c.areaName="",c.$apply()}c.copyToClipBoard=function(e){var o=$("."+e+"CpyBtn"),t=document.queryCommandSupported("copy"),r=o.attr("data-original-title");if(t){var a=document.createElement("textarea");a.value=c[e+"DownloadURL"],document.body.appendChild(a),a.select();try{var n=document.execCommand("copy")?"Copied!":"Whoops, not copied!";o.attr("data-original-title",n).tooltip("show")}catch(e){console.log("Oops, unable to copy")}document.body.removeChild(a),o.attr("data-original-title",r)}else window.prompt("Copy to clipboard: Ctrl+C or Command+C")},c.showTreeCanopyDownloadURL=!1,c.treeCanopyDownloadURL="",c.showTreeHeightDownloadURL=!1,c.treeHeightDownloadURL="",c.showPrimaryForestDownloadURL=!1,c.primaryForestDownloadURL="",c.showForestGainDownloadURL=!1,c.forestGainDownloadURL="",c.showForestLossDownloadURL=!1,c.forestLossDownloadURL="",c.showForestExtendDownloadURL=!1,c.forestExtendDownloadURL="",c.fmsUserInfoTrigger=null,c.modalSubmit=function(e){var o={name:(c.fmsUserDownloadInfo=e).name,email:e.email,organization:e.organization,purpose:e.purpose};s.setUserDownloadInfo(e);var t=c.fmsUserInfoTrigger,r=$("button#"+c.fmsUserInfoTrigger+"Button").data(),a=r.downloadButton;delete o.purpose,o.usage=e.purpose.value;o.type={treeCanopy:"tree_canopy",treeHeight:"tree_height",primaryForest:"primary_forest",forestGain:"forest_gain",forestLoss:"forest_loss",forestExtend:"forest_extend"}[t],"getURL"===a&&(-1<["treeCanopy","treeHeight","forestExtend","primaryForest"].indexOf(t)?c.getDownloadURL(t,r.downloadYear):-1<["forestGain","forestLoss"].indexOf(t)&&c.getDownloadURL(t,r.downloadYearStart,r.downloadYearEnd,!0)),$("#fms-user-info-modal").modal("hide")},c.getDownloadURL=function(t,r,a,e){if(p(r,a,e)){if(!c.fmsUserDownloadInfo)return c.fmsUserInfoTrigger=t,$("#fms-user-info-modal").modal("show"),!0;c["show"+n.capitalizeString(t)+"DownloadURL"]=!1,h("Preparing Download Link...");var o={name:c.fmsUserDownloadInfo.name,email:c.fmsUserDownloadInfo.email,organization:c.fmsUserDownloadInfo.organization,usage:c.fmsUserDownloadInfo.purpose.value,type:{treeCanopy:"tree_canopy",treeHeight:"tree_height",primaryForest:"primary_forest",forestGain:"forest_gain",forestLoss:"forest_loss",forestExtend:"forest_extend"}[t]};s.postUserDownloadInfo(o).then(function(e){if(e.id){var o={startYear:r,endYear:a,shape:c.shape,areaSelectFrom:c.areaSelectFrom,areaName:c.areaName,treeCanopyDefinition:c.treeCanopyDefinition,treeHeightDefinition:c.treeHeightDefinition,type:t};s.getDownloadURL(o).then(function(e){l("Your Download Link is ready!"),c[t+"DownloadURL"]=e.downloadUrl,c["show"+n.capitalizeString(t)+"DownloadURL"]=!0},function(e){u(e.error),console.log(e)})}},function(e){u(e.error),console.log(e)})}},c.showTreeCanopyGDriveFileName=!1,c.showTreeHeightGDriveFileName=!1,c.showPrimaryForestGDriveFileName=!1,c.showForestGainGDriveFileName=!1,c.showForestLossGDriveFileName=!1,c.showForestExtendGDriveFileName=!1,c.showGDriveFileName=function(e,o,t,r){p(o,t,r)&&(c["show"+n.capitalizeString(e)+"GDriveFileName"]=!0)},c.hideGDriveFileName=function(e){c["show"+n.capitalizeString(e)+"GDriveFileName"]=!1},c.saveToDrive=function(o,e,t,r){if(p(e,t,r)){var a=i($("#"+o+"GDriveFileName").val()||"");h("Please wait while I prepare the download link for you. This might take a while!");var n={startYear:e,endYear:t,fileName:a,shape:c.shape,areaSelectFrom:c.areaSelectFrom,areaName:c.areaName,treeCanopyDefinition:c.treeCanopyDefinition,treeHeightDefinition:c.treeHeightDefinition,type:o};s.saveToDrive(n).then(function(e){e.error?(u(e.error),console.log(e.error)):(h(e.info),c.hideGDriveFileName(o),$("#"+o+"GDriveFileName").val(""))},function(e){u(e.error),console.log(e)})}},c.loadAdminArea=function(e){d.clearDrawing(c.overlays.polygon),d.removeGeoJson(y),c.shape={},c.areaName=e,d.loadGeoJson(y,c.areaSelectFrom,e)};var m=new google.maps.drawing.DrawingManager;c.drawShape=function(e){m.setOptions(d.getDrawingManagerOptions(e)),m.setMap(y)},google.maps.event.addListener(m,"overlaycomplete",function(o){d.clearDrawing(c.overlays.polygon),d.removeGeoJson(y),f();var e=o.overlay;c.overlays.polygon=e,c.shape={};var t=o.type;if("rectangle"===(c.shape.type=t))c.shape.geom=d.getRectangleBoundArray(e.getBounds()),a=d.computeRectangleArea(e.getBounds()),google.maps.event.addListener(e,"bounds_changed",function(){c.shape.geom=d.getRectangleBoundArray(o.overlay.getBounds()),a=d.computeRectangleArea(o.overlay.getBounds()),g()});else if("circle"===t)c.shape.center=d.getCircleCenter(e),c.shape.radius=d.getCircleRadius(e),a=d.computeCircleArea(e),google.maps.event.addListener(e,"radius_changed",function(){c.shape.radius=d.getCircleRadius(o.overlay),a=d.computeCircleArea(o.overlay),g()}),google.maps.event.addListener(e,"center_changed",function(){c.shape.center=d.getCircleCenter(o.overlay),a=d.computeCircleArea(o.overlay)});else if("polygon"===t){var r=e.getPath();c.shape.geom=d.getPolygonBoundArray(r.getArray()),a=d.computePolygonArea(r),google.maps.event.addListener(r,"insert_at",function(){var e=o.overlay.getPath();c.shape.geom=d.getPolygonBoundArray(e.getArray()),a=d.computePolygonArea(e),g()}),google.maps.event.addListener(r,"remove_at",function(){var e=o.overlay.getPath();c.shape.geom=d.getPolygonBoundArray(e.getArray()),a=d.computePolygonArea(e),g()}),google.maps.event.addListener(r,"set_at",function(){var e=o.overlay.getPath();c.shape.geom=d.getPolygonBoundArray(e.getArray()),a=d.computePolygonArea(e),g()})}m.setDrawingMode(null),g()}),y.data.addListener("addfeature",function(e){c.shownGeoJson=e.feature;var o=new google.maps.LatLngBounds,t=e.feature.getGeometry();d.processPoints(t,o.extend,o),y.fitBounds(o),void 0===c.areaSelectFrom&&(a=google.maps.geometry.spherical.computeArea(t.getArray()[0].b)/1e6,g())}),y.data.addListener("removefeature",function(e){c.shownGeoJson=null});function w(e){var o=e.target.files;if(1<o.length)u("upload one file at a time"),c.$apply();else{d.removeGeoJson(y);var p=o[0],t=new FileReader;t.readAsText(p),t.onload=function(e){var o,t=e.target.result;if(-1<["application/vnd.google-earth.kml+xml","application/vnd.google-earth.kmz"].indexOf(p.type)){var r;if(window.DOMParser)r=(new DOMParser).parseFromString(t,"text/xml");else(r=new ActiveXObject("Microsoft.XMLDOM")).async=!1,r.loadXML(t);o=toGeoJSON.kml(r)}else try{o=JSON.parse(t)}catch(e){u("we only accept kml, kmz and geojson"),c.$apply()}if(o.features&&1===o.features.length||"Feature"===o.type){var a=o.features?o.features[0].geometry:o.geometry;if("Polygon"===a.type){d.addGeoJson(y,o);for(var n=[],i=a.coordinates[0],s=0;s<i.length;s++){var l=[i[s][0].toFixed(2),i[s][1].toFixed(2)];n.push(l)}500<n.length&&(h("Complex geometry will be simplified using the convex hull algorithm!"),c.$apply()),f(),c.shape.type="polygon",c.shape.geom=n}else u("multigeometry and multipolygon not supported yet!"),c.$apply()}else u("multigeometry and multipolygon not supported yet!"),c.$apply()}}}$("#file-input-container #file-input").change(function(e){c.showLoader=!0,c.$apply(),d.clearDrawing(c.overlays.polygon),w(e),$(this).remove(),$("<input type='file' class='hide' id='file-input' accept='.kml,.kmz,.json,.geojson,application/json,application/vnd.google-earth.kml+xml,application/vnd.google-earth.kmz'>").change(w).appendTo($("#file-input-container")),c.showLoader=!1});function v(e,o,t,r){d.removeGeoJson(y);var a,n,i=d.getMapType(o.eeMapId,o.eeMapToken,e);a=e,n=i,y.overlayMapTypes.push(n),c.overlays[a]=n,t.slider("setValue",1),l(r),c.showLoader=!1}function C(e){c.showLoader=!1,console.log(e),u(e.error)}var F={formatter:function(e){return e}};c.showTreeCanopyOpacitySlider=!1,c.treeCanopyOpacitySliderValue=null,c.showTreeCanopyDownloadButtons=!1;var S=$("#tree-canopy-opacity-slider").slider(F).on("slideStart",function(e){c.treeCanopyOpacitySliderValue=$(this).data("slider").getValue()}).on("slideStop",function(e){var o=$(this).data("slider").getValue();o!==c.treeCanopyOpacitySliderValue&&(c.treeCanopyOpacitySliderValue=o,c.overlays.treeCanopy.setOpacity(o))});$("#treeCanopySwitch").change(function(){$(this).is(":checked")?c.overlays.treeCanopy.setOpacity(c.treeCanopyOpacitySliderValue):c.overlays.treeCanopy.setOpacity(0)}),c.treeCanopyYearChange=function(o){c.showLoader=!0;var t="treeCanopy";d.clearLayer(y,t),c.closeAlert(),c.showTreeCanopyOpacitySlider=!1;var e={year:o,shape:c.shape,areaSelectFrom:c.areaSelectFrom,areaName:c.areaName,treeCanopyDefinition:c.treeCanopyDefinition,type:t};s.treeCanopyChange(e).then(function(e){v(t,e,S,"Tree Canopy Cover for year "+o+" !"),c.showTreeCanopyOpacitySlider=!0,c.showTreeCanopyDownloadButtons=!0},function(e){C(e)}),s.getStats(e).then(function(e){c.showReportNoPolygon=!1,e.area?(c.reportTreeCanopyTitle="Tree Canopy Cover for "+o,c.reportTreeCanopyValue=e.area,c.showReportTreeCanopy=!0):e.reportError&&(c.reportTreeCanopyTitle="Error calculating Canopy",c.reportTreeCanopyValue=e.reportError,c.showReportTreeCanopy=!0)},function(e){C(e)})},c.showTreeHeightOpacitySlider=!1,c.treeHeightOpacitySliderValue=null,c.showTreeHeightDownloadButtons=!1;var D=$("#tree-height-opacity-slider").slider(F).on("slideStart",function(e){c.treeHeightOpacitySliderValue=$(this).data("slider").getValue()}).on("slideStop",function(e){var o=$(this).data("slider").getValue();o!==c.treeHeightOpacitySliderValue&&(c.treeHeightOpacitySliderValue=o,c.overlays.treeHeight.setOpacity(o))});$("#treeHeightSwitch").change(function(){$(this).is(":checked")?c.overlays.treeHeight.setOpacity(c.treeHeightOpacitySliderValue):c.overlays.treeHeight.setOpacity(0)}),c.treeHeightYearChange=function(o){c.showLoader=!0;var t="treeHeight";d.clearLayer(y,t),c.closeAlert(),c.showTreeHeightOpacitySlider=!1;var e={year:o,shape:c.shape,areaSelectFrom:c.areaSelectFrom,areaName:c.areaName,treeHeightDefinition:c.treeHeightDefinition};s.treeHeightChange(e).then(function(e){v(t,e,D,"Tree Canopy Height for year "+o+" !"),c.showTreeHeightOpacitySlider=!0,c.showTreeHeightDownloadButtons=!0},function(e){C(e)})},c.showPrimaryForestOpacitySlider=!1,c.primaryForestOpacitySliderValue=null,c.showPrimaryForestDownloadButtons=!1;var L=$("#primary-forest-opacity-slider").slider(F).on("slideStart",function(e){c.primaryForestOpacitySliderValue=$(this).data("slider").getValue()}).on("slideStop",function(e){var o=$(this).data("slider").getValue();o!==c.primaryForestOpacitySliderValue&&(c.primaryForestOpacitySliderValue=o,c.overlays.primaryForest.setOpacity(o))});$("#primaryForestSwitch").change(function(){$(this).is(":checked")?c.overlays.primaryForest.setOpacity(c.primaryForestOpacitySliderValue):c.overlays.primaryForest.setOpacity(0)}),c.primaryForestYearChange=function(o){c.showLoader=!0;var t="primaryForest";d.clearLayer(y,t),c.closeAlert(),c.showprimaryForestOpacitySlider=!1;var e={year:o,shape:c.shape,areaSelectFrom:c.areaSelectFrom,areaName:c.areaName,type:t};s.primaryForestChange(e).then(function(e){v(t,e,L,"Primary Forest for year "+o+" !"),c.showPrimaryForestOpacitySlider=!0,c.showPrimaryForestDownloadButtons=!0},function(e){C(e)}),s.getStats(e).then(function(e){c.showReportNoPolygon=!1,e.area?(c.reportPrimaryForestTitle="Primary Forest for "+o,c.reportPrimaryForestValue=e.area,c.showReportPrimaryForest=!0):e.reportError&&(c.reportPrimaryForestTitle="Error calculating Primary Forest",c.reportPrimaryForestValue=e.reportError,c.showReportPrimaryForest=!0)},function(e){C(e)})},c.showForestGainOpacitySlider=!1,c.forestGainOpacitySliderValue=null,c.showForestGainDownloadButtons=!1;var O=$("#forest-gain-opacity-slider").slider(F).on("slideStart",function(e){c.forestGainOpacitySliderValue=$(this).data("slider").getValue()}).on("slideStop",function(e){var o=$(this).data("slider").getValue();o!==c.forestGainOpacitySliderValue&&(c.forestGainOpacitySliderValue=o,c.overlays.forestGain.setOpacity(o))});$("#forestGainSwitch").change(function(){$(this).is(":checked")?c.overlays.forestGain.setOpacity(c.forestGainOpacitySliderValue):c.overlays.forestGain.setOpacity(0)}),c.calculateForestGain=function(o,t){c.showLoader=!0;var r="forestGain";d.clearLayer(y,r),c.closeAlert(),c.showForestGainOpacitySlider=!1;var e={startYear:o,endYear:t,shape:c.shape,areaSelectFrom:c.areaSelectFrom,areaName:c.areaName,treeCanopyDefinition:c.treeCanopyDefinition,treeHeightDefinition:c.treeHeightDefinition,type:r};s.forestGain(e).then(function(e){v(r,e,O,"Forest Gain from year "+o+" to "+t+" !"),c.showForestGainOpacitySlider=!0,c.showForestGainDownloadButtons=!0},function(e){C(e)}),s.getStats(e).then(function(e){c.showReportNoPolygon=!1,e.area?(c.reportForestGainTitle="GAIN AREA ("+o+" - "+t+") with tree cover canopy >"+c.treeCanopyDefinition+"% and tree height >"+c.treeHeightDefinition+" meters",c.reportForestGainValue=e.area,c.showReportForestGain=!0):e.reportError&&(c.reportForestGainTitle="Error calculating Forest Gain",c.reportForestGainValue=e.reportError,c.showReportForestGain=!0)},function(e){C(e)})},c.showForestLossOpacitySlider=!1,c.forestLossOpacitySliderValue=null,c.showForestLossDownloadButtons=!1;var T=$("#forest-loss-opacity-slider").slider(F).on("slideStart",function(e){c.forestLossOpacitySliderValue=$(this).data("slider").getValue()}).on("slideStop",function(e){var o=$(this).data("slider").getValue();o!==c.forestLossOpacitySliderValue&&(c.forestLossOpacitySliderValue=o,c.overlays.forestLoss.setOpacity(o))});$("#forestLossSwitch").change(function(){$(this).is(":checked")?c.overlays.forestLoss.setOpacity(c.forestLossOpacitySliderValue):c.overlays.forestLoss.setOpacity(0)}),c.calculateForestLoss=function(o,t){c.showLoader=!0;var r="forestLoss";d.clearLayer(y,r),c.closeAlert(),c.showForestLossOpacitySlider=!1;var e={startYear:o,endYear:t,shape:c.shape,areaSelectFrom:c.areaSelectFrom,areaName:c.areaName,treeCanopyDefinition:c.treeCanopyDefinition,treeHeightDefinition:c.treeHeightDefinition,type:r};s.forestLoss(e).then(function(e){v(r,e,T,"Forest Loss from year "+o+" to "+t+" !"),c.showForestLossOpacitySlider=!0,c.showForestLossDownloadButtons=!0},function(e){C(e)}),s.getStats(e).then(function(e){c.showReportNoPolygon=!1,e.area?(c.reportForestLossTitle="LOSS AREA ("+o+" - "+t+") with tree canopy cover >"+c.treeCanopyDefinition+"% and tree height >"+c.treeHeightDefinition+" meters",c.reportForestLossValue=e.area,c.showReportForestLoss=!0):e.reportError&&(c.reportForestLossTitle="Error calculating Forest Loss",c.reportForestLossValue=e.reportError,c.showReportForestLoss=!0)},function(e){C(e)})},c.showForestExtendOpacitySlider=!1,c.forestExtendOpacitySliderValue=null,c.showForestExtendDownloadButtons=!1;var R=$("#forest-extend-opacity-slider").slider(F).on("slideStart",function(e){c.forestExtendOpacitySliderValue=$(this).data("slider").getValue()}).on("slideStop",function(e){var o=$(this).data("slider").getValue();o!==c.forestExtendOpacitySliderValue&&(c.forestExtendOpacitySliderValue=o,c.overlays.forestExtend.setOpacity(o))});$("#forestExtendSwitch").change(function(){$(this).is(":checked")?c.overlays.forestExtend.setOpacity(c.forestExtendOpacitySliderValue):c.overlays.forestExtend.setOpacity(0)}),c.calculateForestExtend=function(o){c.showLoader=!0;var t="forestExtend";d.clearLayer(y,t),c.closeAlert(),c.showForestExtendOpacitySlider=!1;var e={year:o,shape:c.shape,areaSelectFrom:c.areaSelectFrom,areaName:c.areaName,treeCanopyDefinition:c.treeCanopyDefinition,treeHeightDefinition:c.treeHeightDefinition,type:t};s.forestExtend(e).then(function(e){v(t,e,R,"Forest Extend for year "+o+" !"),c.showForestExtendOpacitySlider=!0,c.showForestExtendDownloadButtons=!0},function(e){C(e)}),s.getStats(e).then(function(e){c.showReportNoPolygon=!1,e.area?(c.reportForestExtendTitle="Forest Extend for "+o,c.reportForestExtendValue=e.area,c.showReportForestExtend=!0):e.reportError&&(c.reportForestExtendTitle="Error calculating Forest Extend",c.reportForestExtendValue=e.reportError)},function(e){C(e)})}}])}();
!function(){"use strict";angular.module("baseApp").controller("landCoverController",["$http","$rootScope","$scope","$sanitize","$timeout","appSettings","CommonService","MapService","LandCoverService",function(o,e,c,n,s,l,t,p,d){var m=p.init();c.areaIndexSelectors=l.areaIndexSelectors,c.landCoverClasses=[],c.primitiveClasses=[],c.landCoverClassesColor={},c.mapClass=t.mapClass,c.sideClass=t.sideClass,e.$broadcast("showToggleFullScreenIcon",{show:!0}),e.$on("toggleFullScreen",function(e,a){c.mapClass=a.mapClass,c.sideClass=a.sideClass,"col-md-12 col-lg-12"===a.mapClass?($(".custom-alert").css({"margin-left":"10%",width:"calc(100vw - 20%)"}),$(".slider-year-container").css({width:"85%"})):($(".custom-alert").css({"margin-left":"25.5%",width:"calc(100vw - 26%)"}),$(".slider-year-container").css({width:"60%"}))}),c.overlays={},c.shape={},c.areaSelectFrom=null,c.areaName=null,c.shownGeoJson=null,c.showAreaVariableSelector=!1,c.alertContent="",c.toolControlClass="glyphicon glyphicon-eye-open",c.showTabContainer=!0,c.showReportChart=!1,c.showLoader=!1,c.sliderYear=null,c.sliderEndYear=null,c.typologyCSV=null,c.closeAlert=function(){$(".custom-alert").addClass("display-none"),c.alertContent=""};function v(e){c.alertContent=e,$(".custom-alert").removeClass("display-none").removeClass("alert-info").removeClass("alert-success").addClass("alert-danger")}function g(e){c.alertContent=e,$(".custom-alert").removeClass("display-none").removeClass("alert-success").removeClass("alert-danger").addClass("alert-info")}c.showEmailID=!1,c.emailID="",c.googleSignIn=function(){auth2.grantOfflineAccess().then(function(e){if(e.code){var a={method:"POST",url:"/storeauthcode/",headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/octet-stream; charset=utf-8"},data:{authcode:e.code}};o(a).then(function(e){var a=e.data;a.success?(c.showEmailID=!0,c.emailID=a.email):v("there was an error while authenticating using google sign-in")}).catch(function(e){throw console.log("Error: ",e),e.data})}else v("there was an error while authenticating using google sign-in")})},c.googleSignOut=function(){gapi.auth2.getAuthInstance().signOut().then(function(){console.log("User signed out."),c.emailID="",c.showEmailID=!1,c.$apply()})};function u(e,a){void 0===a&&(a=!0);var o={landcovermap:"Land Cover Map for "+c.sliderYear,compositemap:"Composite Map for "+c.sliderYear,probabilitymap:"Probability Map",primitivemap:"Primitive Layer for "+c.sliderYear,polygon:"User Defined Area",preload:"Pre-defined Area"};0<$("#layer-tab #layer-control-"+e).length&&$("#layer-tab #layer-control-"+e).remove();var r=t.createLayerContainer(o,e,c.overlays[e],m,a);$("#layer-tab").append(r),-1<["polygon","preload"].indexOf(e)?console.log("no slider initialized"):function(e,o){c[o+"Opacity"]=1;$("."+e).slider({formatter:function(e){return e}}).on("slideStart",function(e){c[o+"Opacity"]=$(this).data("slider").getValue()}).on("slideStop",function(e){var a=$(this).data("slider").getValue();a!==c[o+"Opacity"]&&c.overlays[o].setOpacity(a)})}("layer-opacity-slider-"+e,e)}c.toggleToolControl=function(){$("#analysis-tool-control i").hasClass("fas fa-times")?($("#analysis-tool-control i").removeClass("fas fa-times").addClass("fas fa-eye"),c.showTabContainer=!1):($("#analysis-tool-control i").removeClass("fas fa-chart-pie").addClass("fas fa-times"),c.showTabContainer=!0),c.$apply()};var a=document.getElementById("tool-control-container");new t.AnalysisToolControl(a).addEventListener("click",function(){c.toggleToolControl()}),m.controls[google.maps.ControlPosition.TOP_RIGHT].push(a),$(".tab-tool .btn-pref .btn").click(function(){$(".tab-tool .btn-pref .btn").removeClass("btn-primary").addClass("btn-default"),$(this).removeClass("btn-default").addClass("btn-primary")}),$(".tab-tool .btn-pref-inner .btn").click(function(){$(".tab-tool .btn-pref-inner .btn").removeClass("btn-primary").addClass("btn-default"),$(this).removeClass("btn-default").addClass("btn-primary")}),$("#sidebar-tab .btn-pref .btn").click(function(){$("#sidebar-tab .btn-pref .btn").removeClass("btn-primary").addClass("btn-default"),$(this).removeClass("btn-default").addClass("btn-primary")}),$(".js-tooltip").tooltip(),s(function(){for(var e=document.getElementsByClassName("tree-caret"),a=function(){$(this.parentElement.parentElement).find(".nested").toggle("tree-caret-active"),this.classList.toggle("tree-caret-down")},o=0;o<e.length;o++)e[o].addEventListener("click",a);$(".nested-checkbox").change(function(){for(var e=$(".nested-checkbox input").is(":checked"),a=$(this.parentElement.parentElement).find(".nested"),o=0;o<a.length;o++)$(a[o]).find(".custom-checkbox-container input").prop("checked",e)})},0),c.populateAreaVariableOptions=function(e){c.showAreaVariableSelector=!0,c.areaSelectFrom=e.value,c.areaVariableOptions=t.getAreaVariableOptions(e.value)};function y(){c.areaSelectFrom="",c.areaIndexSelector="",c.areaName="",c.$apply()}function h(e,a){m.overlayMapTypes.push(a),c.overlays[e]=a,c.showLoader=!1}c.initMap=function(e,o,a,r){if(c.showLoader=!0,c.sliderYear=e,c.sliderEndYear=e,"v1"===a?(c.typologyCSV="/static/data/typology_value_v1.csv",c.landCoverClasses=l.landCoverClassesV1,c.primitiveClasses=l.primitiveClassesV1):("v2"===a?(c.typologyCSV="/static/data/typology_value_v2.csv",c.landCoverClasses=l.landCoverClassesV2):(c.typologyCSV="/static/data/typology_value.csv",c.landCoverClasses=l.landCoverClasses),c.primitiveClasses=l.primitiveClasses),void 0===r&&(r=!1),r){c.assemblageLayers=[];for(var t=0;t<=c.landCoverClasses.length-1;t++)c.assemblageLayers.push(t.toString())}c.landCoverClassesColor={};for(var n=0;n<c.landCoverClasses.length;n++)c.landCoverClassesColor[c.landCoverClasses[n].name]=c.landCoverClasses[n].color;var i={classes:c.assemblageLayers,year:e,shape:c.shape,areaSelectFrom:c.areaSelectFrom,areaName:c.areaName,version:a};d.getLandCoverMap(i).then(function(e){var a=p.getMapType(e.eeMapId,e.eeMapToken,o);h(o,a),s(function(){g("The map data shows the landcover data for "+c.sliderYear)},3500),u(o,!0)},function(e){c.showLoader=!1,v(e.error),console.log(e)})},c.getStats=function(e){$("#report-tab").html("<h4>Please wait while I generate chart for you...</h4>");var a={classes:c.assemblageLayers,year:c.sliderYear,shape:c.shape,areaSelectFrom:c.areaSelectFrom,areaName:c.areaName,version:e};d.getStats(a).then(function(e){var a=[];for(var o in e)a.push({name:o,y:e[o],color:c.landCoverClassesColor[o]});t.buildChart(a,"report-tab","Landcover types for "+c.sliderYear)},function(e){console.log(e)})};function i(e){void 0===e&&(e="landcover");var a=!0,o=!0;return-1<["polygon","circle","rectangle"].indexOf(c.shape.type)||c.areaSelectFrom||c.areaName||(v("Please draw a polygon or select administrative region before proceding to download!"),a=!1),"primitive"===e&&(c.primitiveIndex||(v("Select a primitive Layer to Download!"),o=!1)),a&&o}c.copyToClipBoard=function(e){void 0===e&&(e="landcover");var a=$("."+e+"CpyBtn"),o=document.queryCommandSupported("copy"),r=a.attr("data-original-title");if(o){var t=document.createElement("textarea");t.value=c[e+"DownloadURL"],document.body.appendChild(t),t.select();try{var n=document.execCommand("copy")?"Copied!":"Whoops, not copied!";a.attr("data-original-title",n).tooltip("show")}catch(e){console.log("Oops, unable to copy")}document.body.removeChild(t),a.attr("data-original-title",r)}else window.prompt("Copy to clipboard: Ctrl+C or Command+C")},c.loadAdminArea=function(e){var a;a="polygon",0<$("#layer-tab #layer-control-"+a).length&&$("#layer-tab #layer-control-"+a).remove(),p.clearDrawing(c.overlays.polygon),p.removeGeoJson(m),c.shape={},c.areaName=e,p.loadGeoJson(m,c.areaSelectFrom,e),u("preload",!0)};var f=new google.maps.drawing.DrawingManager;c.drawShape=function(e){f.setOptions(p.getDrawingManagerOptions(e)),f.setMap(m)},google.maps.event.addListener(f,"overlaycomplete",function(a){p.clearDrawing(c.overlays.polygon),p.removeGeoJson(m),y();var e=a.overlay;c.overlays.polygon=e,u("polygon",!0),c.shape={};var o=a.type;if("rectangle"===(c.shape.type=o))c.shape.geom=p.getRectangleBoundArray(e.getBounds()),google.maps.event.addListener(e,"bounds_changed",function(){c.shape.geom=p.getRectangleBoundArray(a.overlay.getBounds())});else if("circle"===o)c.shape.center=p.getCircleCenter(e),c.shape.radius=p.getCircleRadius(e),google.maps.event.addListener(e,"radius_changed",function(){c.shape.radius=p.getCircleRadius(a.overlay)}),google.maps.event.addListener(e,"center_changed",function(){c.shape.center=p.getCircleCenter(a.overlay)});else if("polygon"===o){var r=e.getPath();c.shape.geom=p.getPolygonBoundArray(r.getArray()),google.maps.event.addListener(r,"insert_at",function(){var e=a.overlay.getPath();c.shape.geom=p.getPolygonBoundArray(e.getArray())}),google.maps.event.addListener(r,"remove_at",function(){var e=a.overlay.getPath();c.shape.geom=p.getPolygonBoundArray(e.getArray())}),google.maps.event.addListener(r,"set_at",function(){var e=a.overlay.getPath();c.shape.geom=p.getPolygonBoundArray(e.getArray())})}f.setDrawingMode(null)}),m.data.addListener("addfeature",function(e){c.shownGeoJson=e.feature;var a=new google.maps.LatLngBounds,o=e.feature.getGeometry();p.processPoints(o,a.extend,a),m.fitBounds(a)}),m.data.addListener("removefeature",function(e){c.shownGeoJson=null});function r(e){var a=e.target.files;if(1<a.length)v("upload one file at a time"),c.$apply();else{p.removeGeoJson(m);var d=a[0],o=new FileReader;o.readAsText(d),o.onload=function(e){var a,o=e.target.result;if(-1<["application/vnd.google-earth.kml+xml","application/vnd.google-earth.kmz"].indexOf(d.type)){var r;if(window.DOMParser)r=(new DOMParser).parseFromString(o,"text/xml");else(r=new ActiveXObject("Microsoft.XMLDOM")).async=!1,r.loadXML(o);a=toGeoJSON.kml(r)}else try{a=JSON.parse(o)}catch(e){v("we only accept kml, kmz and geojson"),c.$apply()}if(a.features&&1===a.features.length||"Feature"===a.type){var t=a.features?a.features[0].geometry:a.geometry;if("Polygon"===t.type){p.addGeoJson(m,a);for(var n=[],i=t.coordinates[0],s=0;s<i.length;s++){var l=[i[s][0].toFixed(2),i[s][1].toFixed(2)];n.push(l)}500<n.length&&(g("Complex geometry will be simplified using the convex hull algorithm!"),c.$apply()),y(),c.shape.type="polygon",c.shape.geom=n}else v("multigeometry and multipolygon not supported yet!"),c.$apply()}else v("multigeometry and multipolygon not supported yet!"),c.$apply()}}}$("#file-input-container #file-input").change(function(e){c.showLoader=!0,c.$apply(),p.clearDrawing(c.overlays.polygon),r(e),$(this).remove(),$("<input type='file' class='hide' id='file-input' accept='.kml,.kmz,.json,.geojson,application/json,application/vnd.google-earth.kml+xml,application/vnd.google-earth.kmz'>").change(r).appendTo($("#file-input-container")),c.showLoader=!1});c.updateAssemblageProduct=function(e){c.showLoader=!0,c.closeAlert(),c.assemblageLayers=[],$('input[name="assemblage-checkbox"]').each(function(){$(this).prop("checked")&&c.assemblageLayers.push($(this).val())}),p.clearLayer(m,"landcovermap"),c.initMap(c.sliderYear,"landcovermap",e),p.removeGeoJson(m)},s(function(){$("#slider-year-selector").ionRangeSlider({skin:"round",grid:!0,min:1987,max:c.sliderEndYear,from:c.sliderEndYear,force_edges:!0,grid_num:c.sliderEndYear-1987,prettify_enabled:!1,onFinish:function(e){c.sliderYear!==e.from&&(c.sliderYear=e.from,$("#land-cover-classes-tab").hasClass("active")?(c.updateAssemblageProduct("v3"),c.showProbabilityMap(),c.showCompositeMap()):$("#primitive-tab").hasClass("active")&&c.updatePrimitive(c.primitiveIndex,"v3"))}})},2e3),s(function(){$("#slider-year-selector-version1").ionRangeSlider({skin:"round",grid:!0,min:2e3,max:c.sliderEndYear,from:c.sliderEndYear,force_edges:!0,grid_num:c.sliderEndYear-2e3,prettify_enabled:!1,onFinish:function(e){c.sliderYear!==e.from&&(c.sliderYear=e.from,$("#land-cover-classes-tab").hasClass("active")?c.updateAssemblageProduct("v1"):$("#primitive-tab").hasClass("active")&&c.updatePrimitive(c.primitiveIndex,"v1"))}})},2e3),s(function(){$("#slider-year-selector-version2").ionRangeSlider({skin:"round",grid:!0,min:2e3,max:c.sliderEndYear,from:c.sliderEndYear,force_edges:!0,grid_num:c.sliderEndYear-2e3,prettify_enabled:!1,onFinish:function(e){c.sliderYear!==e.from&&(c.sliderYear=e.from,$("#land-cover-classes-tab").hasClass("active")?(c.updateAssemblageProduct("v2"),c.showProbabilityMap()):$("#primitive-tab").hasClass("active")&&c.updatePrimitive(c.primitiveIndex,"v2"))}})},2e3),c.landcoverDownloadURL="",c.showLandcoverDownloadURL=!1,c.showPrimitiveDownloadURL=!1,c.primitiveDownloadURL="",c.getDownloadURL=function(e){var o=e.type||"landcover",a=e.version;if(i(o)){c["show"+t.capitalizeString(o)+"DownloadURL"]=!1,g("Preparing Download Link...");var r={classes:c.assemblageLayers,year:c.sliderYear,shape:c.shape,areaSelectFrom:c.areaSelectFrom,areaName:c.areaName,version:a,type:o,index:c.primitiveIndex};d.getDownloadURL(r).then(function(e){var a;a="Your Download Link is ready!",c.alertContent=a,$(".custom-alert").removeClass("display-none").removeClass("alert-info").removeClass("alert-danger").addClass("alert-success"),c[o+"DownloadURL"]=e.downloadUrl,c["show"+t.capitalizeString(o)+"DownloadURL"]=!0},function(e){v(e.error),console.log(e)})}},c.showLandcoverGDriveFileName=!1,c.showGDriveFileName=function(e){void 0===e&&(e="landcover"),i(e)&&(c["show"+t.capitalizeString(e)+"GDriveFileName"]=!0)},c.hideGDriveFileName=function(e){c["show"+t.capitalizeString(e)+"GDriveFileName"]=!1},c.saveToDrive=function(e){var a=e.type||"landcover",o=e.version;if(i(a)){var r=n($("#"+a+"GDriveFileName").val()||"");g("Please wait while I prepare the download link for you. This might take a while!");var t={classes:c.assemblageLayers,year:c.sliderYear,shape:c.shape,areaSelectFrom:c.areaSelectFrom,areaName:c.areaName,version:o,type:a,index:c.primitiveIndex,fileName:r};d.saveToDrive(t).then(function(e){e.error?(v(e.error),console.log(e.error)):(g(e.info),c.hideGDriveFileName(a),$("#"+a+"GDriveFileName").val(""))},function(e){v(e.error),console.log(e)})}};c.updatePrimitive=function(r,e){c.showLoader=!0,c.showPrimitiveOpacitySlider=!1;var a={index:r,year:c.sliderYear,shape:c.shape,areaSelectFrom:c.areaSelectFrom,areaName:c.areaName,version:e};d.getPrimitiveMap(a).then(function(e){var a="primitivemap";p.removeGeoJson(m),p.clearLayer(m,a);var o=p.getMapType(e.eeMapId,e.eeMapToken,a);h(a,o),s(function(){g("Showing "+function(e){for(var a=c.primitiveClasses.length-1;0<=a;a--)if("string"==typeof e){if(c.primitiveClasses[a].value===e)return c.primitiveClasses[a].name}else if("number"==typeof e&&parseInt(c.primitiveClasses[a].value)===parseInt(e))return c.primitiveClasses[a].name;return""}(r)+" primitive layer for "+c.sliderYear)},3500),c.showPrimitiveOpacitySlider=!0,c.primitiveIndex=r,u(a,!0)},function(e){c.showLoader=!1,v(e.error),console.log(e)})},c.showProbabilityMap=function(){s(function(){var e={year:c.sliderYear,shape:c.shape,areaSelectFrom:c.areaSelectFrom,areaName:c.areaName,type:"landcover"};d.getProbabilityMap(e).then(function(e){var a="probabilitymap";p.removeGeoJson(m),p.clearLayer(m,a);var o=p.getMapType(e.eeMapId,e.eeMapToken,a),r=$("#probability-map-checkbox").prop("checked");h(a,o),r?(s(function(){g("Showing Probability Map Layer for "+c.sliderYear)},5500),c.showProbabilityLayer=!0):c.overlays.probabilitymap.setOpacity(0),u(a,!1)},function(e){v(e.error),console.log(e)})},1e3)},c.showCompositeMap=function(){s(function(){var e={year:c.sliderYear,shape:c.shape,areaSelectFrom:c.areaSelectFrom,areaName:c.areaName,type:"landcover"};d.getCompositeMap(e).then(function(e){var a="compositemap";p.removeGeoJson(m),p.clearLayer(m,a);var o=p.getMapType(e.eeMapId,e.eeMapToken,a),r=$("#composite-map-checkbox").prop("checked");h(a,o),r?(s(function(){g("Showing Yearly Composite Layer for "+c.sliderYear)},5500),c.showCompositeLayer=!0):c.overlays.compositemap.setOpacity(0),u(a,!1)},function(e){v(e.error),console.log(e)})},2e3)}}])}();
!function(){"use strict";angular.module("baseApp").controller("myanmarFRAController",["$rootScope","$http","$scope","$sanitize","$timeout","appSettings","CommonService","MapService","LandCoverService",function(e,o,c,r,t,a,n,p,i){var m=p.init(97.5814,18.8936,5.5);c.typologyCSV="/static/data/myanmar_fra_typology_value.csv",c.myanmarFRALandCoverClasses=a.myanmarFRALandCoverClasses,c.primitiveClasses=a.myanmarPrimitiveClasses,c.areaIndexSelectors=a.areaIndexSelectors,c.landCoverClassesColor={};for(var s=0;s<c.myanmarFRALandCoverClasses.length;s++)c.landCoverClassesColor[c.myanmarFRALandCoverClasses[s].name]=c.myanmarFRALandCoverClasses[s].color;c.overlays={},c.shape={},c.areaSelectFrom=null,c.areaName=null,c.shownGeoJson=null,c.showAreaVariableSelector=!1,c.alertContent="",c.toolControlClass="glyphicon glyphicon-eye-open",c.showTabContainer=!0,c.showLoader=!1,c.startYear=2e3,c.endYear=2017,c.sliderYear=2017;var l={0:[1],1:[3,7,8],2:[6,10],3:[0,2,4,5,9,11]},d=[];for(var g in l)d.push(l[g]);c.assemblageLayers=n.flattenArrays(d),c.mapClass=n.mapClass,c.sideClass=n.sideClass,e.$broadcast("showToggleFullScreenIcon",{show:!0}),e.$on("toggleFullScreen",function(e,a){c.mapClass=a.mapClass,c.sideClass=a.sideClass,"col-md-12 col-lg-12"===a.mapClass?($(".custom-alert").css({"margin-left":"5%",width:"calc(100vw - 20%)"}),$(".slider-year-container").css({width:"85%"})):($(".custom-alert").css({"margin-left":"25.5%",width:"calc(100vw - 26%)"}),$(".slider-year-container").css({width:"60%"}))}),c.closeAlert=function(){$(".custom-alert").addClass("display-none"),c.alertContent=""};function v(e){c.alertContent=e,$(".custom-alert").removeClass("display-none").removeClass("alert-info").removeClass("alert-success").addClass("alert-danger")}function u(e){c.alertContent=e,$(".custom-alert").removeClass("display-none").removeClass("alert-success").removeClass("alert-danger").addClass("alert-info")}c.showEmailID=!1,c.emailID="",c.googleSignIn=function(){auth2.grantOfflineAccess().then(function(e){if(e.code){var a={method:"POST",url:"/storeauthcode/",headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/octet-stream; charset=utf-8"},data:{authcode:e.code}};o(a).then(function(e){var a=e.data;a.success?(c.showEmailID=!0,c.emailID=a.email):v("there was an error while authenticating using google sign-in")}).catch(function(e){throw console.log("Error: ",e),e.data})}else v("there was an error while authenticating using google sign-in")})},c.googleSignOut=function(){gapi.auth2.getAuthInstance().signOut().then(function(){console.log("User signed out."),c.emailID="",c.showEmailID=!1,c.$apply()})},c.toggleToolControl=function(){$("#analysis-tool-control i").hasClass("fas fa-times")?($("#analysis-tool-control i").removeClass("fas fa-times").addClass("fas fa-chart-pie"),c.showTabContainer=!1):($("#analysis-tool-control i").removeClass("fas fa-chart-pie").addClass("fas fa-times"),c.showTabContainer=!0),c.$apply()};var y=document.getElementById("tool-control-container");new n.AnalysisToolControl(y).addEventListener("click",function(){c.toggleToolControl()}),m.controls[google.maps.ControlPosition.TOP_RIGHT].push(y),$(".tab-tool .btn-pref .btn").click(function(){$(".tab-tool .btn-pref .btn").removeClass("btn-primary").addClass("btn-default"),$(this).removeClass("btn-default").addClass("btn-primary")}),$(".tab-tool .btn-pref-inner .btn").click(function(){$(".tab-tool .btn-pref-inner .btn").removeClass("btn-primary").addClass("btn-default"),$(this).removeClass("btn-default").addClass("btn-primary")}),$("#sidebar-tab .btn-pref .btn").click(function(){$("#sidebar-tab .btn-pref .btn").removeClass("btn-primary").addClass("btn-default"),$(this).removeClass("btn-default").addClass("btn-primary")}),$(".js-tooltip").tooltip(),c.landcoverOpacity=1,c.showLandcoverOpacitySlider=!0;$("#landcover-opacity-slider").slider({formatter:function(e){return"Opacity: "+e},tooltip:"always"}).on("slideStart",function(e){c.landcoverOpacity=$(this).data("slider").getValue()}).on("slideStop",function(e){var a=$(this).data("slider").getValue();a!==c.landcoverOpacity&&c.overlays.landcovermap.setOpacity(a)});c.primitiveOpacity=1,c.showPrimitiveOpacitySlider=!1;$("#primitive-opacity-slider").slider({formatter:function(e){return"Opacity: "+e},tooltip:"always"}).on("slideStart",function(e){c.primitiveOpacity=$(this).data("slider").getValue()}).on("slideStop",function(e){var a=$(this).data("slider").getValue();a!==c.primitiveOpacity&&c.overlays.primitivemap.setOpacity(a)});c.populateAreaVariableOptions=function(e){c.showAreaVariableSelector=!0,c.areaSelectFrom=e.value,c.areaVariableOptions=n.getAreaVariableOptions(e.value,!0)};function h(){c.areaSelectFrom="",c.areaIndexSelector="",c.areaName="",c.$apply()}function f(e,a){m.overlayMapTypes.push(a),c.overlays[e]=a,c.showLoader=!1}c.initMap=function(e,o){c.showLoader=!0;var a={classes:c.assemblageLayers,year:e,shape:c.shape,areaSelectFrom:c.areaSelectFrom,areaName:c.areaName,type:"myanmar-fra"};i.getLandCoverMap(a).then(function(e){var a=p.getMapType(e.eeMapId,e.eeMapToken,o);f(o,a),t(function(){u("The map data shows the landcover data for "+c.sliderYear)},3500)},function(e){c.showLoader=!1,v(e.error),console.log(e)})},c.getStats=function(){$("#report-tab").html("<h4>Please wait while I generate chart for you...</h4>");var e={classes:c.assemblageLayers,year:c.sliderYear,shape:c.shape,areaSelectFrom:c.areaSelectFrom,areaName:c.areaName,type:"myanmar-fra"};i.getStats(e).then(function(e){var a=[];for(var o in e)a.push({name:o,y:e[o],color:c.landCoverClassesColor[o]});n.buildChart(a,"report-tab","Landcover types for "+c.sliderYear)},function(e){console.log(e)})};function C(e){void 0===e&&(e="landcover");var a=!0,o=!0;return-1<["polygon","circle","rectangle"].indexOf(c.shape.type)||c.areaSelectFrom||c.areaName||(v("Please draw a polygon or select administrative region before proceding to download!"),a=!1),"primitive"===e&&(c.primitiveIndex||(v("Select a primitive Layer to Download!"),o=!1)),a&&o}c.copyToClipBoard=function(e){void 0===e&&(e="landcover");var a=$("."+e+"CpyBtn"),o=document.queryCommandSupported("copy"),r=a.attr("data-original-title");if(o){var t=document.createElement("textarea");t.value=c[e+"DownloadURL"],document.body.appendChild(t),t.select();try{var n=document.execCommand("copy")?"Copied!":"Whoops, not copied!";a.attr("data-original-title",n).tooltip("show")}catch(e){console.log("Oops, unable to copy")}document.body.removeChild(t),a.attr("data-original-title",r)}else window.prompt("Copy to clipboard: Ctrl+C or Command+C")},c.loadAdminArea=function(e){p.clearDrawing(c.overlays.polygon),p.removeGeoJson(m),c.shape={},c.areaName=e,p.loadGeoJson(m,c.areaSelectFrom,e)};var w=new google.maps.drawing.DrawingManager;c.drawShape=function(e){w.setOptions(p.getDrawingManagerOptions(e)),w.setMap(m)},google.maps.event.addListener(w,"overlaycomplete",function(a){p.clearDrawing(c.overlays.polygon),p.removeGeoJson(m),h();var e=a.overlay;c.overlays.polygon=e,c.shape={};var o=a.type;if("rectangle"===(c.shape.type=o))c.shape.geom=p.getRectangleBoundArray(e.getBounds()),google.maps.event.addListener(e,"bounds_changed",function(){c.shape.geom=p.getRectangleBoundArray(a.overlay.getBounds())});else if("circle"===o)c.shape.center=p.getCircleCenter(e),c.shape.radius=p.getCircleRadius(e),google.maps.event.addListener(e,"radius_changed",function(){c.shape.radius=p.getCircleRadius(a.overlay)}),google.maps.event.addListener(e,"center_changed",function(){c.shape.center=p.getCircleCenter(a.overlay)});else if("polygon"===o){var r=e.getPath();c.shape.geom=p.getPolygonBoundArray(r.getArray()),google.maps.event.addListener(r,"insert_at",function(){var e=a.overlay.getPath();c.shape.geom=p.getPolygonBoundArray(e.getArray())}),google.maps.event.addListener(r,"remove_at",function(){var e=a.overlay.getPath();c.shape.geom=p.getPolygonBoundArray(e.getArray())}),google.maps.event.addListener(r,"set_at",function(){var e=a.overlay.getPath();c.shape.geom=p.getPolygonBoundArray(e.getArray())})}w.setDrawingMode(null)}),m.data.addListener("addfeature",function(e){c.shownGeoJson=e.feature;var a=new google.maps.LatLngBounds,o=e.feature.getGeometry();p.processPoints(o,a.extend,a),m.fitBounds(a)}),m.data.addListener("removefeature",function(e){c.shownGeoJson=null});function b(e){var a=e.target.files;if(1<a.length)v("upload one file at a time"),c.$apply();else{p.removeGeoJson(m);var d=a[0],o=new FileReader;o.readAsText(d),o.onload=function(e){var a,o=e.target.result;if(-1<["application/vnd.google-earth.kml+xml","application/vnd.google-earth.kmz"].indexOf(d.type)){var r;if(window.DOMParser)r=(new DOMParser).parseFromString(o,"text/xml");else(r=new ActiveXObject("Microsoft.XMLDOM")).async=!1,r.loadXML(o);a=toGeoJSON.kml(r)}else try{a=JSON.parse(o)}catch(e){v("we only accept kml, kmz and geojson"),c.$apply()}if(a.features&&1===a.features.length||"Feature"===a.type){var t=a.features?a.features[0].geometry:a.geometry;if("Polygon"===t.type){p.addGeoJson(m,a);for(var n=[],i=t.coordinates[0],s=0;s<i.length;s++){var l=[i[s][0].toFixed(2),i[s][1].toFixed(2)];n.push(l)}500<n.length&&(u("Complex geometry will be simplified using the convex hull algorithm!"),c.$apply()),h(),c.shape.type="polygon",c.shape.geom=n}else v("multigeometry and multipolygon not supported yet!"),c.$apply()}else v("multigeometry and multipolygon not supported yet!"),c.$apply()}}}$("#file-input-container #file-input").change(function(e){c.showLoader=!0,c.$apply(),p.clearDrawing(c.overlays.polygon),b(e),$(this).remove(),$("<input type='file' class='hide' id='file-input' accept='.kml,.kmz,.json,.geojson,application/json,application/vnd.google-earth.kml+xml,application/vnd.google-earth.kmz'>").change(b).appendTo($("#file-input-container")),c.showLoader=!1});c.updateAssemblageProduct=function(){c.closeAlert();var e=[];$('input[name="assemblage-checkbox"]').each(function(){$(this).prop("checked")&&e.push($(this).val())});var a=e.length;if(a<c.myanmarFRALandCoverClasses.length+1){for(var o=[],r=0;r<a;r++)o.push(l[e[r]]);c.assemblageLayers=n.flattenArrays(o)}c.showLoader=!0,p.clearLayer(m,"landcovermap"),c.initMap(c.sliderYear,"landcovermap"),c.getStats(),p.removeGeoJson(m)},$("#slider-year-selector").ionRangeSlider({skin:"round",grid:!0,min:c.startYear,max:c.endYear,from:c.endYear,force_edges:!0,grid_num:c.endYear-c.startYear,prettify_enabled:!1,onFinish:function(e){c.sliderYear!==e.from&&(c.sliderYear=e.from,$("#land-cover-classes-tab").hasClass("active")?c.updateAssemblageProduct():$("#primitive-tab").hasClass("active")&&c.updatePrimitive(c.primitiveIndex))}}),c.landcoverDownloadURL="",c.showLandcoverDownloadURL=!1,c.showPrimitiveDownloadURL=!1,c.primitiveDownloadURL="",c.getDownloadURL=function(o){if(void 0===o&&(o="landcover"),C(o)){c["show"+n.capitalizeString(o)+"DownloadURL"]=!1,u("Preparing Download Link...");var e={classes:c.assemblageLayers,year:c.sliderYear,shape:c.shape,areaSelectFrom:c.areaSelectFrom,areaName:c.areaName,type:o,index:c.primitiveIndex,serviceType:"myanmar-fra"};i.getDownloadURL(e).then(function(e){var a;a="Your Download Link is ready!",c.alertContent=a,$(".custom-alert").removeClass("display-none").removeClass("alert-info").removeClass("alert-danger").addClass("alert-success"),c[o+"DownloadURL"]=e.downloadUrl,c["show"+n.capitalizeString(o)+"DownloadURL"]=!0},function(e){v(e.error),console.log(e)})}},c.showLandcoverGDriveFileName=!1,c.showGDriveFileName=function(e){void 0===e&&(e="landcover"),C(e)&&(c["show"+n.capitalizeString(e)+"GDriveFileName"]=!0)},c.hideGDriveFileName=function(e){c["show"+n.capitalizeString(e)+"GDriveFileName"]=!1},c.saveToDrive=function(a){if(void 0===a&&(a="landcover"),C(a)){var e=r($("#"+a+"GDriveFileName").val()||"");u("Please wait while I prepare the download link for you. This might take a while!");var o={classes:c.assemblageLayers,year:c.sliderYear,shape:c.shape,areaSelectFrom:c.areaSelectFrom,areaName:c.areaName,type:a,index:c.primitiveIndex,fileName:e,serviceType:"myanmar-fra"};i.saveToDrive(o).then(function(e){e.error?(v(e.error),console.log(e.error)):(u(e.info),c.hideGDriveFileName(a),$("#"+a+"GDriveFileName").val(""))},function(e){v(e.error),console.log(e)})}};c.updatePrimitive=function(o){c.showLoader=!0,c.showPrimitiveOpacitySlider=!1;var e={index:o,year:c.sliderYear,shape:c.shape,areaSelectFrom:c.areaSelectFrom,areaName:c.areaName,type:"myanmar-fra"};i.getPrimitiveMap(e).then(function(e){p.removeGeoJson(m),p.clearLayer(m,"primitivemap");var a=p.getMapType(e.eeMapId,e.eeMapToken,"primitivemap");f("primitivemap",a),t(function(){u("Showing "+function(e){for(var a=c.primitiveClasses.length-1;0<=a;a--)if("string"==typeof e){if(c.primitiveClasses[a].value===e)return c.primitiveClasses[a].name}else if("number"==typeof e&&parseInt(c.primitiveClasses[a].value)===parseInt(e))return c.primitiveClasses[a].name;return""}(o)+" primitive layer for "+c.sliderYear)},3500),c.showPrimitiveOpacitySlider=!0,c.primitiveIndex=o},function(e){c.showLoader=!1,v(e.error),console.log(e)})}}])}();
!function(){"use strict";angular.module("baseApp").controller("myanmarIPCCController",["$http","$rootScope","$scope","$sanitize","$timeout","appSettings","CommonService","MapService","LandCoverService",function(o,e,d,t,r,a,n,p,i){var m=p.init(97.5814,18.8936,5.5);d.typologyCSV="/static/data/myanmar_ipcc_typology_value.csv",d.myanmarIPCCLandCoverClasses=a.myanmarIPCCLandCoverClasses,d.primitiveClasses=a.myanmarPrimitiveClasses,d.areaIndexSelectors=a.areaIndexSelectors,d.landCoverClassesColor={};for(var s=0;s<d.myanmarIPCCLandCoverClasses.length;s++)d.landCoverClassesColor[d.myanmarIPCCLandCoverClasses[s].name]=d.myanmarIPCCLandCoverClasses[s].color;d.overlays={},d.shape={},d.areaSelectFrom=null,d.areaName=null,d.shownGeoJson=null,d.showAreaVariableSelector=!1,d.alertContent="",d.toolControlClass="glyphicon glyphicon-eye-open",d.showTabContainer=!0,d.showLoader=!1,d.startYear=2e3,d.endYear=2017,d.sliderYear=2017;var l={0:[3,7,8,10],1:[6],2:[4],3:[5],4:[1,9],5:[0,2,11]},c=[];for(var g in l)c.push(l[g]);d.assemblageLayers=n.flattenArrays(c),d.mapClass=n.mapClass,d.sideClass=n.sideClass,e.$broadcast("showToggleFullScreenIcon",{show:!0}),e.$on("toggleFullScreen",function(e,a){d.mapClass=a.mapClass,d.sideClass=a.sideClass,"col-md-12 col-lg-12"===a.mapClass?($(".custom-alert").css({"margin-left":"5%",width:"calc(100vw - 20%)"}),$(".slider-year-container").css({width:"85%"})):($(".custom-alert").css({"margin-left":"25.5%",width:"calc(100vw - 26%)"}),$(".slider-year-container").css({width:"60%"}))}),d.closeAlert=function(){$(".custom-alert").addClass("display-none"),d.alertContent=""};function v(e){d.alertContent=e,$(".custom-alert").removeClass("display-none").removeClass("alert-info").removeClass("alert-success").addClass("alert-danger")}function u(e){d.alertContent=e,$(".custom-alert").removeClass("display-none").removeClass("alert-success").removeClass("alert-danger").addClass("alert-info")}d.showEmailID=!1,d.emailID="",d.googleSignIn=function(){auth2.grantOfflineAccess().then(function(e){if(e.code){var a={method:"POST",url:"/storeauthcode/",headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/octet-stream; charset=utf-8"},data:{authcode:e.code}};o(a).then(function(e){var a=e.data;a.success?(d.showEmailID=!0,d.emailID=a.email):v("there was an error while authenticating using google sign-in")}).catch(function(e){throw console.log("Error: ",e),e.data})}else v("there was an error while authenticating using google sign-in")})},d.googleSignOut=function(){gapi.auth2.getAuthInstance().signOut().then(function(){console.log("User signed out."),d.emailID="",d.showEmailID=!1,d.$apply()})},d.toggleToolControl=function(){$("#analysis-tool-control i").hasClass("fas fa-times")?($("#analysis-tool-control i").removeClass("fas fa-times").addClass("fas fa-chart-pie"),d.showTabContainer=!1):($("#analysis-tool-control i").removeClass("fas fa-chart-pie").addClass("fas fa-times"),d.showTabContainer=!0),d.$apply()};var y=document.getElementById("tool-control-container");new n.AnalysisToolControl(y).addEventListener("click",function(){d.toggleToolControl()}),m.controls[google.maps.ControlPosition.TOP_RIGHT].push(y),$(".tab-tool .btn-pref .btn").click(function(){$(".tab-tool .btn-pref .btn").removeClass("btn-primary").addClass("btn-default"),$(this).removeClass("btn-default").addClass("btn-primary")}),$(".tab-tool .btn-pref-inner .btn").click(function(){$(".tab-tool .btn-pref-inner .btn").removeClass("btn-primary").addClass("btn-default"),$(this).removeClass("btn-default").addClass("btn-primary")}),$("#sidebar-tab .btn-pref .btn").click(function(){$("#sidebar-tab .btn-pref .btn").removeClass("btn-primary").addClass("btn-default"),$(this).removeClass("btn-default").addClass("btn-primary")}),$(".js-tooltip").tooltip(),d.landcoverOpacity=1,d.showLandcoverOpacitySlider=!0;$("#landcover-opacity-slider").slider({formatter:function(e){return"Opacity: "+e},tooltip:"always"}).on("slideStart",function(e){d.landcoverOpacity=$(this).data("slider").getValue()}).on("slideStop",function(e){var a=$(this).data("slider").getValue();a!==d.landcoverOpacity&&d.overlays.landcovermap.setOpacity(a)});d.primitiveOpacity=1,d.showPrimitiveOpacitySlider=!1;$("#primitive-opacity-slider").slider({formatter:function(e){return"Opacity: "+e},tooltip:"always"}).on("slideStart",function(e){d.primitiveOpacity=$(this).data("slider").getValue()}).on("slideStop",function(e){var a=$(this).data("slider").getValue();a!==d.primitiveOpacity&&d.overlays.primitivemap.setOpacity(a)});d.populateAreaVariableOptions=function(e){d.showAreaVariableSelector=!0,d.areaSelectFrom=e.value,d.areaVariableOptions=n.getAreaVariableOptions(e.value,!0)};function h(){d.areaSelectFrom="",d.areaIndexSelector="",d.areaName="",d.$apply()}function f(e,a){m.overlayMapTypes.push(a),d.overlays[e]=a,d.showLoader=!1}d.initMap=function(e,o){d.showLoader=!0;var a={classes:d.assemblageLayers,year:e,shape:d.shape,areaSelectFrom:d.areaSelectFrom,areaName:d.areaName,type:"myanmar-ipcc"};i.getLandCoverMap(a).then(function(e){var a=p.getMapType(e.eeMapId,e.eeMapToken,o);f(o,a),r(function(){u("The map data shows the landcover data for "+d.sliderYear)},3500)},function(e){d.showLoader=!1,v(e.error),console.log(e)})},d.getStats=function(){$("#report-tab").html("<h4>Please wait while I generate chart for you...</h4>");var e={classes:d.assemblageLayers,year:d.sliderYear,shape:d.shape,areaSelectFrom:d.areaSelectFrom,areaName:d.areaName,type:"myanmar-ipcc"};i.getStats(e).then(function(e){var a=[];for(var o in e)a.push({name:o,y:e[o],color:d.landCoverClassesColor[o]});n.buildChart(a,"report-tab","Landcover types for "+d.sliderYear)},function(e){console.log(e)})};function C(e){void 0===e&&(e="landcover");var a=!0,o=!0;return-1<["polygon","circle","rectangle"].indexOf(d.shape.type)||d.areaSelectFrom||d.areaName||(v("Please draw a polygon or select administrative region before proceding to download!"),a=!1),"primitive"===e&&(d.primitiveIndex||(v("Select a primitive Layer to Download!"),o=!1)),a&&o}d.copyToClipBoard=function(e){void 0===e&&(e="landcover");var a=$("."+e+"CpyBtn"),o=document.queryCommandSupported("copy"),t=a.attr("data-original-title");if(o){var r=document.createElement("textarea");r.value=d[e+"DownloadURL"],document.body.appendChild(r),r.select();try{var n=document.execCommand("copy")?"Copied!":"Whoops, not copied!";a.attr("data-original-title",n).tooltip("show")}catch(e){console.log("Oops, unable to copy")}document.body.removeChild(r),a.attr("data-original-title",t)}else window.prompt("Copy to clipboard: Ctrl+C or Command+C")},d.loadAdminArea=function(e){p.clearDrawing(d.overlays.polygon),p.removeGeoJson(m),d.shape={},d.areaName=e,p.loadGeoJson(m,d.areaSelectFrom,e)};var w=new google.maps.drawing.DrawingManager;d.drawShape=function(e){w.setOptions(p.getDrawingManagerOptions(e)),w.setMap(m)},google.maps.event.addListener(w,"overlaycomplete",function(a){p.clearDrawing(d.overlays.polygon),p.removeGeoJson(m),h();var e=a.overlay;d.overlays.polygon=e,d.shape={};var o=a.type;if("rectangle"===(d.shape.type=o))d.shape.geom=p.getRectangleBoundArray(e.getBounds()),google.maps.event.addListener(e,"bounds_changed",function(){d.shape.geom=p.getRectangleBoundArray(a.overlay.getBounds())});else if("circle"===o)d.shape.center=p.getCircleCenter(e),d.shape.radius=p.getCircleRadius(e),google.maps.event.addListener(e,"radius_changed",function(){d.shape.radius=p.getCircleRadius(a.overlay)}),google.maps.event.addListener(e,"center_changed",function(){d.shape.center=p.getCircleCenter(a.overlay)});else if("polygon"===o){var t=e.getPath();d.shape.geom=p.getPolygonBoundArray(t.getArray()),google.maps.event.addListener(t,"insert_at",function(){var e=a.overlay.getPath();d.shape.geom=p.getPolygonBoundArray(e.getArray())}),google.maps.event.addListener(t,"remove_at",function(){var e=a.overlay.getPath();d.shape.geom=p.getPolygonBoundArray(e.getArray())}),google.maps.event.addListener(t,"set_at",function(){var e=a.overlay.getPath();d.shape.geom=p.getPolygonBoundArray(e.getArray())})}w.setDrawingMode(null)}),m.data.addListener("addfeature",function(e){d.shownGeoJson=e.feature;var a=new google.maps.LatLngBounds,o=e.feature.getGeometry();p.processPoints(o,a.extend,a),m.fitBounds(a)}),m.data.addListener("removefeature",function(e){d.shownGeoJson=null});function b(e){var a=e.target.files;if(1<a.length)v("upload one file at a time"),d.$apply();else{p.removeGeoJson(m);var c=a[0],o=new FileReader;o.readAsText(c),o.onload=function(e){var a,o=e.target.result;if(-1<["application/vnd.google-earth.kml+xml","application/vnd.google-earth.kmz"].indexOf(c.type)){var t;if(window.DOMParser)t=(new DOMParser).parseFromString(o,"text/xml");else(t=new ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(o);a=toGeoJSON.kml(t)}else try{a=JSON.parse(o)}catch(e){v("we only accept kml, kmz and geojson"),d.$apply()}if(a.features&&1===a.features.length||"Feature"===a.type){var r=a.features?a.features[0].geometry:a.geometry;if("Polygon"===r.type){p.addGeoJson(m,a);for(var n=[],i=r.coordinates[0],s=0;s<i.length;s++){var l=[i[s][0].toFixed(2),i[s][1].toFixed(2)];n.push(l)}500<n.length&&(u("Complex geometry will be simplified using the convex hull algorithm!"),d.$apply()),h(),d.shape.type="polygon",d.shape.geom=n}else v("multigeometry and multipolygon not supported yet!"),d.$apply()}else v("multigeometry and multipolygon not supported yet!"),d.$apply()}}}$("#file-input-container #file-input").change(function(e){d.showLoader=!0,d.$apply(),p.clearDrawing(d.overlays.polygon),b(e),$(this).remove(),$("<input type='file' class='hide' id='file-input' accept='.kml,.kmz,.json,.geojson,application/json,application/vnd.google-earth.kml+xml,application/vnd.google-earth.kmz'>").change(b).appendTo($("#file-input-container")),d.showLoader=!1});d.updateAssemblageProduct=function(){d.closeAlert();var e=[];$('input[name="assemblage-checkbox"]').each(function(){$(this).prop("checked")&&e.push($(this).val())});var a=e.length;if(a<d.myanmarIPCCLandCoverClasses.length+1){for(var o=[],t=0;t<a;t++)o.push(l[e[t]]);d.assemblageLayers=n.flattenArrays(o)}d.showLoader=!0,p.clearLayer(m,"landcovermap"),d.initMap(d.sliderYear,"landcovermap"),d.getStats(),p.removeGeoJson(m)},$("#slider-year-selector").ionRangeSlider({skin:"round",grid:!0,min:d.startYear,max:d.endYear,from:d.endYear,force_edges:!0,grid_num:d.endYear-d.startYear,prettify_enabled:!1,onFinish:function(e){d.sliderYear!==e.from&&(d.sliderYear=e.from,$("#land-cover-classes-tab").hasClass("active")?d.updateAssemblageProduct():$("#primitive-tab").hasClass("active")&&d.updatePrimitive(d.primitiveIndex))}}),d.landcoverDownloadURL="",d.showLandcoverDownloadURL=!1,d.showPrimitiveDownloadURL=!1,d.primitiveDownloadURL="",d.getDownloadURL=function(o){if(void 0===o&&(o="landcover"),C(o)){d["show"+n.capitalizeString(o)+"DownloadURL"]=!1,u("Preparing Download Link...");var e={classes:d.assemblageLayers,year:d.sliderYear,shape:d.shape,areaSelectFrom:d.areaSelectFrom,areaName:d.areaName,type:o,index:d.primitiveIndex,serviceType:"myanmar-ipcc"};i.getDownloadURL(e).then(function(e){var a;a="Your Download Link is ready!",d.alertContent=a,$(".custom-alert").removeClass("display-none").removeClass("alert-info").removeClass("alert-danger").addClass("alert-success"),d[o+"DownloadURL"]=e.downloadUrl,d["show"+n.capitalizeString(o)+"DownloadURL"]=!0},function(e){v(e.error),console.log(e)})}},d.showLandcoverGDriveFileName=!1,d.showGDriveFileName=function(e){void 0===e&&(e="landcover"),C(e)&&(d["show"+n.capitalizeString(e)+"GDriveFileName"]=!0)},d.hideGDriveFileName=function(e){d["show"+n.capitalizeString(e)+"GDriveFileName"]=!1},d.saveToDrive=function(a){if(void 0===a&&(a="landcover"),C(a)){var e=t($("#"+a+"GDriveFileName").val()||"");u("Please wait while I prepare the download link for you. This might take a while!");var o={classes:d.assemblageLayers,year:d.sliderYear,shape:d.shape,areaSelectFrom:d.areaSelectFrom,areaName:d.areaName,type:a,index:d.primitiveIndex,fileName:e,serviceType:"myanmar-ipcc"};i.saveToDrive(o).then(function(e){e.error?(v(e.error),console.log(e.error)):(u(e.info),d.hideGDriveFileName(a),$("#"+a+"GDriveFileName").val(""))},function(e){v(e.error),console.log(e)})}};d.updatePrimitive=function(o){d.showLoader=!0,d.showPrimitiveOpacitySlider=!1;var e={index:o,year:d.sliderYear,shape:d.shape,areaSelectFrom:d.areaSelectFrom,areaName:d.areaName,type:"myanmar-ipcc"};i.getPrimitiveMap(e).then(function(e){p.removeGeoJson(m),p.clearLayer(m,"primitivemap");var a=p.getMapType(e.eeMapId,e.eeMapToken,"primitivemap");f("primitivemap",a),r(function(){u("Showing "+function(e){for(var a=d.primitiveClasses.length-1;0<=a;a--)if("string"==typeof e){if(d.primitiveClasses[a].value===e)return d.primitiveClasses[a].name}else if("number"==typeof e&&parseInt(d.primitiveClasses[a].value)===parseInt(e))return d.primitiveClasses[a].name;return""}(o)+" primitive layer for "+d.sliderYear)},3500),d.showPrimitiveOpacitySlider=!0,d.primitiveIndex=o},function(e){d.showLoader=!1,v(e.error),console.log(e)})}}])}();
!function(){"use strict";angular.module("baseApp").controller("myanmarNationalController",["$rootScope","$http","$scope","$sanitize","$timeout","appSettings","CommonService","MapService","LandCoverService",function(e,o,d,t,r,a,n,p,i){var m=p.init(97.5814,18.8936,5.5);d.typologyCSV="/static/data/myanmar_national_typology_value.csv",d.myanmarNationalClasses=a.myanmarNationalClasses,d.primitiveClasses=a.myanmarPrimitiveClasses,d.areaIndexSelectors=a.areaIndexSelectors,d.landCoverClassesColor={};for(var l=0;l<d.myanmarNationalClasses.length;l++)d.landCoverClassesColor[d.myanmarNationalClasses[l].name]=d.myanmarNationalClasses[l].color;d.overlays={},d.shape={},d.areaSelectFrom=null,d.areaName=null,d.shownGeoJson=null,d.showAreaVariableSelector=!1,d.alertContent="",d.toolControlClass="glyphicon glyphicon-eye-open",d.showTabContainer=!0,d.showLoader=!1,d.startYear=2e3,d.endYear=2017,d.sliderYear=2017,d.assemblageLayers=[];for(var s=0;s<=d.myanmarNationalClasses.length-1;s++)d.assemblageLayers.push(s.toString());d.mapClass=n.mapClass,d.sideClass=n.sideClass,e.$broadcast("showToggleFullScreenIcon",{show:!0}),e.$on("toggleFullScreen",function(e,a){d.mapClass=a.mapClass,d.sideClass=a.sideClass,"col-md-12 col-lg-12"===a.mapClass?($(".custom-alert").css({"margin-left":"5%",width:"calc(100vw - 20%)"}),$(".slider-year-container").css({width:"85%"})):($(".custom-alert").css({"margin-left":"25.5%",width:"calc(100vw - 26%)"}),$(".slider-year-container").css({width:"60%"}))}),d.closeAlert=function(){$(".custom-alert").addClass("display-none"),d.alertContent=""};function g(e){d.alertContent=e,$(".custom-alert").removeClass("display-none").removeClass("alert-info").removeClass("alert-success").addClass("alert-danger")}function u(e){d.alertContent=e,$(".custom-alert").removeClass("display-none").removeClass("alert-success").removeClass("alert-danger").addClass("alert-info")}d.showEmailID=!1,d.emailID="",d.googleSignIn=function(){auth2.grantOfflineAccess().then(function(e){if(e.code){var a={method:"POST",url:"/storeauthcode/",headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/octet-stream; charset=utf-8"},data:{authcode:e.code}};o(a).then(function(e){var a=e.data;a.success?(d.showEmailID=!0,d.emailID=a.email):g("there was an error while authenticating using google sign-in")}).catch(function(e){throw console.log("Error: ",e),e.data})}else g("there was an error while authenticating using google sign-in")})},d.googleSignOut=function(){gapi.auth2.getAuthInstance().signOut().then(function(){console.log("User signed out."),d.emailID="",d.showEmailID=!1,d.$apply()})},d.toggleToolControl=function(){$("#analysis-tool-control i").hasClass("fas fa-times")?($("#analysis-tool-control i").removeClass("fas fa-times").addClass("fas fa-chart-pie"),d.showTabContainer=!1):($("#analysis-tool-control i").removeClass("fas fa-chart-pie").addClass("fas fa-times"),d.showTabContainer=!0),d.$apply()};var c=document.getElementById("tool-control-container");new n.AnalysisToolControl(c).addEventListener("click",function(){d.toggleToolControl()}),m.controls[google.maps.ControlPosition.TOP_RIGHT].push(c),$(".tab-tool .btn-pref .btn").click(function(){$(".tab-tool .btn-pref .btn").removeClass("btn-primary").addClass("btn-default"),$(this).removeClass("btn-default").addClass("btn-primary")}),$(".tab-tool .btn-pref-inner .btn").click(function(){$(".tab-tool .btn-pref-inner .btn").removeClass("btn-primary").addClass("btn-default"),$(this).removeClass("btn-default").addClass("btn-primary")}),$("#sidebar-tab .btn-pref .btn").click(function(){$("#sidebar-tab .btn-pref .btn").removeClass("btn-primary").addClass("btn-default"),$(this).removeClass("btn-default").addClass("btn-primary")}),$(".js-tooltip").tooltip(),d.landcoverOpacity=1,d.showLandcoverOpacitySlider=!0;$("#landcover-opacity-slider").slider({formatter:function(e){return"Opacity: "+e},tooltip:"always"}).on("slideStart",function(e){d.landcoverOpacity=$(this).data("slider").getValue()}).on("slideStop",function(e){var a=$(this).data("slider").getValue();a!==d.landcoverOpacity&&d.overlays.landcovermap.setOpacity(a)});d.primitiveOpacity=1,d.showPrimitiveOpacitySlider=!1;$("#primitive-opacity-slider").slider({formatter:function(e){return"Opacity: "+e},tooltip:"always"}).on("slideStart",function(e){d.primitiveOpacity=$(this).data("slider").getValue()}).on("slideStop",function(e){var a=$(this).data("slider").getValue();a!==d.primitiveOpacity&&d.overlays.primitivemap.setOpacity(a)});d.populateAreaVariableOptions=function(e){d.showAreaVariableSelector=!0,d.areaSelectFrom=e.value,d.areaVariableOptions=n.getAreaVariableOptions(e.value,!0)};function v(){d.areaSelectFrom="",d.areaIndexSelector="",d.areaName="",d.$apply()}function y(e,a){m.overlayMapTypes.push(a),d.overlays[e]=a,d.showLoader=!1}d.initMap=function(e,o){d.showLoader=!0;var a={classes:d.assemblageLayers,year:e,shape:d.shape,areaSelectFrom:d.areaSelectFrom,areaName:d.areaName,type:"myanmar-national"};i.getLandCoverMap(a).then(function(e){var a=p.getMapType(e.eeMapId,e.eeMapToken,o);y(o,a),r(function(){u("The map data shows the landcover data for "+d.sliderYear)},3500)},function(e){d.showLoader=!1,g(e.error),console.log(e)})},d.getStats=function(){$("#report-tab").html("<h4>Please wait while I generate chart for you...</h4>");var e={classes:d.assemblageLayers,year:d.sliderYear,shape:d.shape,areaSelectFrom:d.areaSelectFrom,areaName:d.areaName,type:"myanmar-national"};i.getStats(e).then(function(e){var a=[];for(var o in e)a.push({name:o,y:e[o],color:d.landCoverClassesColor[o]});n.buildChart(a,"report-tab","Landcover types for "+d.sliderYear)},function(e){console.log(e)})};function h(e){void 0===e&&(e="landcover");var a=!0,o=!0;return-1<["polygon","circle","rectangle"].indexOf(d.shape.type)||d.areaSelectFrom||d.areaName||(g("Please draw a polygon or select administrative region before proceding to download!"),a=!1),"primitive"===e&&(d.primitiveIndex||(g("Select a primitive Layer to Download!"),o=!1)),a&&o}d.copyToClipBoard=function(e){void 0===e&&(e="landcover");var a=$("."+e+"CpyBtn"),o=document.queryCommandSupported("copy"),t=a.attr("data-original-title");if(o){var r=document.createElement("textarea");r.value=d[e+"DownloadURL"],document.body.appendChild(r),r.select();try{var n=document.execCommand("copy")?"Copied!":"Whoops, not copied!";a.attr("data-original-title",n).tooltip("show")}catch(e){console.log("Oops, unable to copy")}document.body.removeChild(r),a.attr("data-original-title",t)}else window.prompt("Copy to clipboard: Ctrl+C or Command+C")},d.loadAdminArea=function(e){p.clearDrawing(d.overlays.polygon),p.removeGeoJson(m),d.shape={},d.areaName=e,p.loadGeoJson(m,d.areaSelectFrom,e)};var f=new google.maps.drawing.DrawingManager;d.drawShape=function(e){f.setOptions(p.getDrawingManagerOptions(e)),f.setMap(m)},google.maps.event.addListener(f,"overlaycomplete",function(a){p.clearDrawing(d.overlays.polygon),p.removeGeoJson(m),v();var e=a.overlay;d.overlays.polygon=e,d.shape={};var o=a.type;if("rectangle"===(d.shape.type=o))d.shape.geom=p.getRectangleBoundArray(e.getBounds()),google.maps.event.addListener(e,"bounds_changed",function(){d.shape.geom=p.getRectangleBoundArray(a.overlay.getBounds())});else if("circle"===o)d.shape.center=p.getCircleCenter(e),d.shape.radius=p.getCircleRadius(e),google.maps.event.addListener(e,"radius_changed",function(){d.shape.radius=p.getCircleRadius(a.overlay)}),google.maps.event.addListener(e,"center_changed",function(){d.shape.center=p.getCircleCenter(a.overlay)});else if("polygon"===o){var t=e.getPath();d.shape.geom=p.getPolygonBoundArray(t.getArray()),google.maps.event.addListener(t,"insert_at",function(){var e=a.overlay.getPath();d.shape.geom=p.getPolygonBoundArray(e.getArray())}),google.maps.event.addListener(t,"remove_at",function(){var e=a.overlay.getPath();d.shape.geom=p.getPolygonBoundArray(e.getArray())}),google.maps.event.addListener(t,"set_at",function(){var e=a.overlay.getPath();d.shape.geom=p.getPolygonBoundArray(e.getArray())})}f.setDrawingMode(null)}),m.data.addListener("addfeature",function(e){d.shownGeoJson=e.feature;var a=new google.maps.LatLngBounds,o=e.feature.getGeometry();p.processPoints(o,a.extend,a),m.fitBounds(a)}),m.data.addListener("removefeature",function(e){d.shownGeoJson=null});function C(e){var a=e.target.files;if(1<a.length)g("upload one file at a time"),d.$apply();else{p.removeGeoJson(m);var c=a[0],o=new FileReader;o.readAsText(c),o.onload=function(e){var a,o=e.target.result;if(-1<["application/vnd.google-earth.kml+xml","application/vnd.google-earth.kmz"].indexOf(c.type)){var t;if(window.DOMParser)t=(new DOMParser).parseFromString(o,"text/xml");else(t=new ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(o);a=toGeoJSON.kml(t)}else try{a=JSON.parse(o)}catch(e){g("we only accept kml, kmz and geojson"),d.$apply()}if(a.features&&1===a.features.length||"Feature"===a.type){var r=a.features?a.features[0].geometry:a.geometry;if("Polygon"===r.type){p.addGeoJson(m,a);for(var n=[],i=r.coordinates[0],l=0;l<i.length;l++){var s=[i[l][0].toFixed(2),i[l][1].toFixed(2)];n.push(s)}500<n.length&&(u("Complex geometry will be simplified using the convex hull algorithm!"),d.$apply()),v(),d.shape.type="polygon",d.shape.geom=n}else g("multigeometry and multipolygon not supported yet!"),d.$apply()}else g("multigeometry and multipolygon not supported yet!"),d.$apply()}}}$("#file-input-container #file-input").change(function(e){d.showLoader=!0,d.$apply(),p.clearDrawing(d.overlays.polygon),C(e),$(this).remove(),$("<input type='file' class='hide' id='file-input' accept='.kml,.kmz,.json,.geojson,application/json,application/vnd.google-earth.kml+xml,application/vnd.google-earth.kmz'>").change(C).appendTo($("#file-input-container")),d.showLoader=!1});d.updateAssemblageProduct=function(){d.closeAlert(),d.assemblageLayers=[];$('input[name="assemblage-checkbox"]').each(function(){$(this).prop("checked")&&d.assemblageLayers.push($(this).val())}),d.showLoader=!0,p.clearLayer(m,"landcovermap"),d.initMap(d.sliderYear,"landcovermap"),d.getStats(),p.removeGeoJson(m)},$("#slider-year-selector").ionRangeSlider({skin:"round",grid:!0,min:d.startYear,max:d.endYear,from:d.endYear,force_edges:!0,grid_num:d.endYear-d.startYear,prettify_enabled:!1,onFinish:function(e){d.sliderYear!==e.from&&(d.sliderYear=e.from,$("#land-cover-classes-tab").hasClass("active")?d.updateAssemblageProduct():$("#primitive-tab").hasClass("active")&&d.updatePrimitive(d.primitiveIndex))}}),d.landcoverDownloadURL="",d.showLandcoverDownloadURL=!1,d.showPrimitiveDownloadURL=!1,d.primitiveDownloadURL="",d.getDownloadURL=function(o){if(void 0===o&&(o="landcover"),h(o)){d["show"+n.capitalizeString(o)+"DownloadURL"]=!1,u("Preparing Download Link...");var e={classes:d.assemblageLayers,year:d.sliderYear,shape:d.shape,areaSelectFrom:d.areaSelectFrom,areaName:d.areaName,type:o,index:d.primitiveIndex,serviceType:"myanmar-national"};i.getDownloadURL(e).then(function(e){var a;a="Your Download Link is ready!",d.alertContent=a,$(".custom-alert").removeClass("display-none").removeClass("alert-info").removeClass("alert-danger").addClass("alert-success"),d[o+"DownloadURL"]=e.downloadUrl,d["show"+n.capitalizeString(o)+"DownloadURL"]=!0},function(e){g(e.error),console.log(e)})}},d.showLandcoverGDriveFileName=!1,d.showGDriveFileName=function(e){void 0===e&&(e="landcover"),h(e)&&(d["show"+n.capitalizeString(e)+"GDriveFileName"]=!0)},d.hideGDriveFileName=function(e){d["show"+n.capitalizeString(e)+"GDriveFileName"]=!1},d.saveToDrive=function(a){if(void 0===a&&(a="landcover"),h(a)){var e=t($("#"+a+"GDriveFileName").val()||"");u("Please wait while I prepare the download link for you. This might take a while!");var o={classes:d.assemblageLayers,year:d.sliderYear,shape:d.shape,areaSelectFrom:d.areaSelectFrom,areaName:d.areaName,type:a,index:d.primitiveIndex,fileName:e,serviceType:"myanmar-national"};i.saveToDrive(o).then(function(e){e.error?(g(e.error),console.log(e.error)):(u(e.info),d.hideGDriveFileName(a),$("#"+a+"GDriveFileName").val(""))},function(e){g(e.error),console.log(e)})}};d.updatePrimitive=function(o){d.showLoader=!0,d.showPrimitiveOpacitySlider=!1;var e={index:o,year:d.sliderYear,shape:d.shape,areaSelectFrom:d.areaSelectFrom,areaName:d.areaName,type:"myanmar-national"};i.getPrimitiveMap(e).then(function(e){p.removeGeoJson(m),p.clearLayer(m,"primitivemap");var a=p.getMapType(e.eeMapId,e.eeMapToken,"primitivemap");y("primitivemap",a),r(function(){u("Showing "+function(e){for(var a=d.primitiveClasses.length-1;0<=a;a--)if("string"==typeof e){if(d.primitiveClasses[a].value===e)return d.primitiveClasses[a].name}else if("number"==typeof e&&parseInt(d.primitiveClasses[a].value)===parseInt(e))return d.primitiveClasses[a].name;return""}(o)+" primitive layer for "+d.sliderYear)},3500),d.showPrimitiveOpacitySlider=!0,d.primitiveIndex=o},function(e){d.showLoader=!1,g(e.error),console.log(e)})}}])}();
!function(){"use strict";angular.module("baseApp").controller("myanmarNationalPortalController",["$rootScope","$http","$scope","$sanitize","$timeout","appSettings","CommonService","MapService","LandCoverService",function(e,o,d,t,r,a,n,p,i){var m=p.init(97.5814,18.8936,5.5);d.typologyCSV="/static/data/myanmar_national_typology_value.csv",d.myanmarNationalClasses=a.myanmarNationalClasses,d.primitiveClasses=a.myanmarPrimitiveClasses,d.areaIndexSelectors=a.areaIndexSelectors,d.landCoverClassesColor={};for(var s=0;s<d.myanmarNationalClasses.length;s++)d.landCoverClassesColor[d.myanmarNationalClasses[s].name]=d.myanmarNationalClasses[s].color;d.overlays={},d.shape={},d.areaSelectFrom=null,d.areaName=null,d.shownGeoJson=null,d.showAreaVariableSelector=!1,d.alertContent="",d.toolControlClass="glyphicon glyphicon-eye-open",d.showTabContainer=!0,d.showLoader=!1,d.startYear=2e3,d.endYear=2017,d.sliderYear=2017,d.assemblageLayers=[];for(var l=0;l<=d.myanmarNationalClasses.length-1;l++)d.assemblageLayers.push(l.toString());d.mapClass=n.mapClass,d.sideClass=n.sideClass,e.$broadcast("showToggleFullScreenIcon",{show:!0}),e.$broadcast("showLogoToggleIcon",{show:!1}),e.$broadcast("changeMenu",{menus:[{name:"Myanmar National IPCC",url:"/myanmar-ipcc/",show:!0},{name:"Myanmar National FRA",url:"/myanmar-fra/",show:!0},{name:"SERVIR Services",url:"/service-applications/",show:!0}]}),e.$broadcast("changeExtraBrands",{extraBrands:[{src:"images/monrec.png",show:!0,href:"http://www.monrec.gov.mm/"}]}),e.$broadcast("changeApplicationName",{application:{name:"Myanmar National LC",url:"/myanmar-national-portal/"}}),e.$on("toggleFullScreen",function(e,a){d.mapClass=a.mapClass,d.sideClass=a.sideClass,"col-md-12 col-lg-12"===a.mapClass?($(".custom-alert").css({"margin-left":"5%",width:"calc(100vw - 20%)"}),$(".slider-year-container").css({width:"85%"})):($(".custom-alert").css({"margin-left":"25.5%",width:"calc(100vw - 26%)"}),$(".slider-year-container").css({width:"60%"}))}),d.closeAlert=function(){$(".custom-alert").addClass("display-none"),d.alertContent=""};function g(e){d.alertContent=e,$(".custom-alert").removeClass("display-none").removeClass("alert-info").removeClass("alert-success").addClass("alert-danger")}function u(e){d.alertContent=e,$(".custom-alert").removeClass("display-none").removeClass("alert-success").removeClass("alert-danger").addClass("alert-info")}d.showEmailID=!1,d.emailID="",d.googleSignIn=function(){auth2.grantOfflineAccess().then(function(e){if(e.code){var a={method:"POST",url:"/storeauthcode/",headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/octet-stream; charset=utf-8"},data:{authcode:e.code}};o(a).then(function(e){var a=e.data;a.success?(d.showEmailID=!0,d.emailID=a.email):g("there was an error while authenticating using google sign-in")}).catch(function(e){throw console.log("Error: ",e),e.data})}else g("there was an error while authenticating using google sign-in")})},d.googleSignOut=function(){gapi.auth2.getAuthInstance().signOut().then(function(){console.log("User signed out."),d.emailID="",d.showEmailID=!1,d.$apply()})},d.toggleToolControl=function(){$("#analysis-tool-control i").hasClass("fas fa-times")?($("#analysis-tool-control i").removeClass("fas fa-times").addClass("fas fa-chart-pie"),d.showTabContainer=!1):($("#analysis-tool-control i").removeClass("fas fa-chart-pie").addClass("fas fa-times"),d.showTabContainer=!0),d.$apply()};var c=document.getElementById("tool-control-container");new n.AnalysisToolControl(c).addEventListener("click",function(){d.toggleToolControl()}),m.controls[google.maps.ControlPosition.TOP_RIGHT].push(c),$(".tab-tool .btn-pref .btn").click(function(){$(".tab-tool .btn-pref .btn").removeClass("btn-primary").addClass("btn-default"),$(this).removeClass("btn-default").addClass("btn-primary")}),$(".tab-tool .btn-pref-inner .btn").click(function(){$(".tab-tool .btn-pref-inner .btn").removeClass("btn-primary").addClass("btn-default"),$(this).removeClass("btn-default").addClass("btn-primary")}),$("#sidebar-tab .btn-pref .btn").click(function(){$("#sidebar-tab .btn-pref .btn").removeClass("btn-primary").addClass("btn-default"),$(this).removeClass("btn-default").addClass("btn-primary")}),$(".js-tooltip").tooltip(),d.landcoverOpacity=1,d.showLandcoverOpacitySlider=!0;$("#landcover-opacity-slider").slider({formatter:function(e){return"Opacity: "+e},tooltip:"always"}).on("slideStart",function(e){d.landcoverOpacity=$(this).data("slider").getValue()}).on("slideStop",function(e){var a=$(this).data("slider").getValue();a!==d.landcoverOpacity&&d.overlays.landcovermap.setOpacity(a)});d.primitiveOpacity=1,d.showPrimitiveOpacitySlider=!1;$("#primitive-opacity-slider").slider({formatter:function(e){return"Opacity: "+e},tooltip:"always"}).on("slideStart",function(e){d.primitiveOpacity=$(this).data("slider").getValue()}).on("slideStop",function(e){var a=$(this).data("slider").getValue();a!==d.primitiveOpacity&&d.overlays.primitivemap.setOpacity(a)});d.populateAreaVariableOptions=function(e){d.showAreaVariableSelector=!0,d.areaSelectFrom=e.value,d.areaVariableOptions=n.getAreaVariableOptions(e.value,!0)};function v(){d.areaSelectFrom="",d.areaIndexSelector="",d.areaName="",d.$apply()}function y(e,a){m.overlayMapTypes.push(a),d.overlays[e]=a,d.showLoader=!1}d.initMap=function(e,o){d.showLoader=!0;var a={classes:d.assemblageLayers,year:e,shape:d.shape,areaSelectFrom:d.areaSelectFrom,areaName:d.areaName,type:"myanmar-national"};i.getLandCoverMap(a).then(function(e){var a=p.getMapType(e.eeMapId,e.eeMapToken,o);y(o,a),r(function(){u("The map data shows the landcover data for "+d.sliderYear)},3500)},function(e){d.showLoader=!1,g(e.error),console.log(e)})},d.getStats=function(){$("#report-tab").html("<h4>Please wait while I generate chart for you...</h4>");var e={classes:d.assemblageLayers,year:d.sliderYear,shape:d.shape,areaSelectFrom:d.areaSelectFrom,areaName:d.areaName,type:"myanmar-national"};i.getStats(e).then(function(e){var a=[];for(var o in e)a.push({name:o,y:e[o],color:d.landCoverClassesColor[o]});n.buildChart(a,"report-tab","Landcover types for "+d.sliderYear)},function(e){console.log(e)})};function h(e){void 0===e&&(e="landcover");var a=!0,o=!0;return-1<["polygon","circle","rectangle"].indexOf(d.shape.type)||d.areaSelectFrom||d.areaName||(g("Please draw a polygon or select administrative region before proceding to download!"),a=!1),"primitive"===e&&(d.primitiveIndex||(g("Select a primitive Layer to Download!"),o=!1)),a&&o}d.copyToClipBoard=function(e){void 0===e&&(e="landcover");var a=$("."+e+"CpyBtn"),o=document.queryCommandSupported("copy"),t=a.attr("data-original-title");if(o){var r=document.createElement("textarea");r.value=d[e+"DownloadURL"],document.body.appendChild(r),r.select();try{var n=document.execCommand("copy")?"Copied!":"Whoops, not copied!";a.attr("data-original-title",n).tooltip("show")}catch(e){console.log("Oops, unable to copy")}document.body.removeChild(r),a.attr("data-original-title",t)}else window.prompt("Copy to clipboard: Ctrl+C or Command+C")},d.loadAdminArea=function(e){p.clearDrawing(d.overlays.polygon),p.removeGeoJson(m),d.shape={},d.areaName=e,p.loadGeoJson(m,d.areaSelectFrom,e)};var f=new google.maps.drawing.DrawingManager;d.drawShape=function(e){f.setOptions(p.getDrawingManagerOptions(e)),f.setMap(m)},google.maps.event.addListener(f,"overlaycomplete",function(a){p.clearDrawing(d.overlays.polygon),p.removeGeoJson(m),v();var e=a.overlay;d.overlays.polygon=e,d.shape={};var o=a.type;if("rectangle"===(d.shape.type=o))d.shape.geom=p.getRectangleBoundArray(e.getBounds()),google.maps.event.addListener(e,"bounds_changed",function(){d.shape.geom=p.getRectangleBoundArray(a.overlay.getBounds())});else if("circle"===o)d.shape.center=p.getCircleCenter(e),d.shape.radius=p.getCircleRadius(e),google.maps.event.addListener(e,"radius_changed",function(){d.shape.radius=p.getCircleRadius(a.overlay)}),google.maps.event.addListener(e,"center_changed",function(){d.shape.center=p.getCircleCenter(a.overlay)});else if("polygon"===o){var t=e.getPath();d.shape.geom=p.getPolygonBoundArray(t.getArray()),google.maps.event.addListener(t,"insert_at",function(){var e=a.overlay.getPath();d.shape.geom=p.getPolygonBoundArray(e.getArray())}),google.maps.event.addListener(t,"remove_at",function(){var e=a.overlay.getPath();d.shape.geom=p.getPolygonBoundArray(e.getArray())}),google.maps.event.addListener(t,"set_at",function(){var e=a.overlay.getPath();d.shape.geom=p.getPolygonBoundArray(e.getArray())})}f.setDrawingMode(null)}),m.data.addListener("addfeature",function(e){d.shownGeoJson=e.feature;var a=new google.maps.LatLngBounds,o=e.feature.getGeometry();p.processPoints(o,a.extend,a),m.fitBounds(a)}),m.data.addListener("removefeature",function(e){d.shownGeoJson=null});function C(e){var a=e.target.files;if(1<a.length)g("upload one file at a time"),d.$apply();else{p.removeGeoJson(m);var c=a[0],o=new FileReader;o.readAsText(c),o.onload=function(e){var a,o=e.target.result;if(-1<["application/vnd.google-earth.kml+xml","application/vnd.google-earth.kmz"].indexOf(c.type)){var t;if(window.DOMParser)t=(new DOMParser).parseFromString(o,"text/xml");else(t=new ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(o);a=toGeoJSON.kml(t)}else try{a=JSON.parse(o)}catch(e){g("we only accept kml, kmz and geojson"),d.$apply()}if(a.features&&1===a.features.length||"Feature"===a.type){var r=a.features?a.features[0].geometry:a.geometry;if("Polygon"===r.type){p.addGeoJson(m,a);for(var n=[],i=r.coordinates[0],s=0;s<i.length;s++){var l=[i[s][0].toFixed(2),i[s][1].toFixed(2)];n.push(l)}500<n.length&&(u("Complex geometry will be simplified using the convex hull algorithm!"),d.$apply()),v(),d.shape.type="polygon",d.shape.geom=n}else g("multigeometry and multipolygon not supported yet!"),d.$apply()}else g("multigeometry and multipolygon not supported yet!"),d.$apply()}}}$("#file-input-container #file-input").change(function(e){d.showLoader=!0,d.$apply(),p.clearDrawing(d.overlays.polygon),C(e),$(this).remove(),$("<input type='file' class='hide' id='file-input' accept='.kml,.kmz,.json,.geojson,application/json,application/vnd.google-earth.kml+xml,application/vnd.google-earth.kmz'>").change(C).appendTo($("#file-input-container")),d.showLoader=!1});d.updateAssemblageProduct=function(){d.closeAlert(),d.assemblageLayers=[];$('input[name="assemblage-checkbox"]').each(function(){$(this).prop("checked")&&d.assemblageLayers.push($(this).val())}),d.showLoader=!0,p.clearLayer(m,"landcovermap"),d.initMap(d.sliderYear,"landcovermap"),d.getStats(),p.removeGeoJson(m)},$("#slider-year-selector").ionRangeSlider({skin:"round",grid:!0,min:d.startYear,max:d.endYear,from:d.endYear,force_edges:!0,grid_num:d.endYear-d.startYear,prettify_enabled:!1,onFinish:function(e){d.sliderYear!==e.from&&(d.sliderYear=e.from,$("#land-cover-classes-tab").hasClass("active")?d.updateAssemblageProduct():$("#primitive-tab").hasClass("active")&&d.updatePrimitive(d.primitiveIndex))}}),d.landcoverDownloadURL="",d.showLandcoverDownloadURL=!1,d.showPrimitiveDownloadURL=!1,d.primitiveDownloadURL="",d.getDownloadURL=function(o){if(void 0===o&&(o="landcover"),h(o)){d["show"+n.capitalizeString(o)+"DownloadURL"]=!1,u("Preparing Download Link...");var e={classes:d.assemblageLayers,year:d.sliderYear,shape:d.shape,areaSelectFrom:d.areaSelectFrom,areaName:d.areaName,type:o,index:d.primitiveIndex,serviceType:"myanmar-national"};i.getDownloadURL(e).then(function(e){var a;a="Your Download Link is ready!",d.alertContent=a,$(".custom-alert").removeClass("display-none").removeClass("alert-info").removeClass("alert-danger").addClass("alert-success"),d[o+"DownloadURL"]=e.downloadUrl,d["show"+n.capitalizeString(o)+"DownloadURL"]=!0},function(e){g(e.error),console.log(e)})}},d.showLandcoverGDriveFileName=!1,d.showGDriveFileName=function(e){void 0===e&&(e="landcover"),h(e)&&(d["show"+n.capitalizeString(e)+"GDriveFileName"]=!0)},d.hideGDriveFileName=function(e){d["show"+n.capitalizeString(e)+"GDriveFileName"]=!1},d.saveToDrive=function(a){if(void 0===a&&(a="landcover"),h(a)){var e=t($("#"+a+"GDriveFileName").val()||"");u("Please wait while I prepare the download link for you. This might take a while!");var o={classes:d.assemblageLayers,year:d.sliderYear,shape:d.shape,areaSelectFrom:d.areaSelectFrom,areaName:d.areaName,type:a,index:d.primitiveIndex,fileName:e,serviceType:"myanmar-national"};i.saveToDrive(o).then(function(e){e.error?(g(e.error),console.log(e.error)):(u(e.info),d.hideGDriveFileName(a),$("#"+a+"GDriveFileName").val(""))},function(e){g(e.error),console.log(e)})}};d.updatePrimitive=function(o){d.showLoader=!0,d.showPrimitiveOpacitySlider=!1;var e={index:o,year:d.sliderYear,shape:d.shape,areaSelectFrom:d.areaSelectFrom,areaName:d.areaName,type:"myanmar-national"};i.getPrimitiveMap(e).then(function(e){p.removeGeoJson(m),p.clearLayer(m,"primitivemap");var a=p.getMapType(e.eeMapId,e.eeMapToken,"primitivemap");y("primitivemap",a),r(function(){u("Showing "+function(e){for(var a=d.primitiveClasses.length-1;0<=a;a--)if("string"==typeof e){if(d.primitiveClasses[a].value===e)return d.primitiveClasses[a].name}else if("number"==typeof e&&parseInt(d.primitiveClasses[a].value)===parseInt(e))return d.primitiveClasses[a].name;return""}(o)+" primitive layer for "+d.sliderYear)},3500),d.showPrimitiveOpacitySlider=!0,d.primitiveIndex=o},function(e){d.showLoader=!1,g(e.error),console.log(e)})}}])}();
!function(){"use strict";angular.module("baseApp").controller("myanmarPlantationController",["$rootScope","$http","$scope","$sanitize","$timeout","appSettings","CommonService","MapService","LandCoverService",function(e,o,p,t,r,a,n,d,i){var m=d.init(95.6106,15.2732,6.56);p.myanmarPlantationClasses=a.myanmarPlantationClasses,p.primitiveClasses=a.myanmarPrimitiveClasses,p.areaIndexSelectors=a.areaIndexSelectors,p.landCoverClassesColor={};for(var l=0;l<p.myanmarPlantationClasses.length;l++)p.landCoverClassesColor[p.myanmarPlantationClasses[l].name]=p.myanmarPlantationClasses[l].color;p.overlays={},p.shape={},p.areaSelectFrom=null,p.areaName=null,p.shownGeoJson=null,p.showAreaVariableSelector=!1,p.alertContent="",p.toolControlClass="glyphicon glyphicon-eye-open",p.showTabContainer=!0,p.showLoader=!1,p.startYear=2015,p.endYear=2018,p.from_min=2017,p.from_max=2018,p.sliderYear=2018,p.assemblageLayers=[0,1,2,3,4,5,6,7],p.mapClass=n.mapClass,p.sideClass=n.sideClass,e.$broadcast("showToggleFullScreenIcon",{show:!0}),e.$on("toggleFullScreen",function(e,a){p.mapClass=a.mapClass,p.sideClass=a.sideClass,"col-md-12 col-lg-12"===a.mapClass?($(".custom-alert").css({"margin-left":"5%",width:"calc(100vw - 20%)"}),$(".slider-year-container").css({width:"85%"})):($(".custom-alert").css({"margin-left":"25.5%",width:"calc(100vw - 26%)"}),$(".slider-year-container").css({width:"60%"}))}),p.closeAlert=function(){$(".custom-alert").addClass("display-none"),p.alertContent=""};function y(e){p.alertContent=e,$(".custom-alert").removeClass("display-none").removeClass("alert-info").removeClass("alert-success").addClass("alert-danger")}function g(e){p.alertContent=e,$(".custom-alert").removeClass("display-none").removeClass("alert-success").removeClass("alert-danger").addClass("alert-info")}p.showEmailID=!1,p.emailID="",p.googleSignIn=function(){auth2.grantOfflineAccess().then(function(e){if(e.code){var a={method:"POST",url:"/storeauthcode/",headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/octet-stream; charset=utf-8"},data:{authcode:e.code}};o(a).then(function(e){var a=e.data;a.success?(p.showEmailID=!0,p.emailID=a.email):y("there was an error while authenticating using google sign-in")}).catch(function(e){throw console.log("Error: ",e),e.data})}else y("there was an error while authenticating using google sign-in")})},p.googleSignOut=function(){gapi.auth2.getAuthInstance().signOut().then(function(){console.log("User signed out."),p.emailID="",p.showEmailID=!1,p.$apply()})},p.toggleToolControl=function(){$("#analysis-tool-control i").hasClass("fas fa-times")?($("#analysis-tool-control i").removeClass("fas fa-times").addClass("fas fa-chart-pie"),p.showTabContainer=!1):($("#analysis-tool-control i").removeClass("fas fa-chart-pie").addClass("fas fa-times"),p.showTabContainer=!0),p.$apply()};var s=document.getElementById("tool-control-container");new n.AnalysisToolControl(s).addEventListener("click",function(){p.toggleToolControl()}),m.controls[google.maps.ControlPosition.TOP_RIGHT].push(s),$(".tab-tool .btn-pref .btn").click(function(){$(".tab-tool .btn-pref .btn").removeClass("btn-primary").addClass("btn-default"),$(this).removeClass("btn-default").addClass("btn-primary")}),$(".tab-tool .btn-pref-inner .btn").click(function(){$(".tab-tool .btn-pref-inner .btn").removeClass("btn-primary").addClass("btn-default"),$(this).removeClass("btn-default").addClass("btn-primary")}),$("#sidebar-tab .btn-pref .btn").click(function(){$("#sidebar-tab .btn-pref .btn").removeClass("btn-primary").addClass("btn-default"),$(this).removeClass("btn-default").addClass("btn-primary")}),$(".js-tooltip").tooltip(),p.primitiveOpacity=1,p.showPrimitiveOpacitySlider=!1;$("#primitive-opacity-slider").slider({formatter:function(e){return"Opacity: "+e},tooltip:"none"}).on("slideStart",function(e){p.primitiveOpacity=$(this).data("slider").getValue()}).on("slideStop",function(e){var a=$(this).data("slider").getValue();a!==p.primitiveOpacity&&p.overlays.primitivemap.setOpacity(a)});p.populateAreaVariableOptions=function(e){p.showAreaVariableSelector=!0,p.areaSelectFrom=e.value,p.areaVariableOptions=n.getAreaVariableOptions(e.value,!0)};function u(){p.areaSelectFrom="",p.areaIndexSelector="",p.areaName="",p.$apply()}function c(e,a){m.overlayMapTypes.push(a),p.overlays[e]=a,p.showLoader=!1}p.initMap=function(a,o){p.showLoader=!0,r(function(){var e={classes:p.assemblageLayers,year:a,shape:p.shape,areaSelectFrom:p.areaSelectFrom,areaName:p.areaName,type:"myanmar-plantation"};i.getLandCoverMap(e).then(function(e){var a=d.getMapType(e.eeMapId,e.eeMapToken,o);c(o,a),r(function(){g("The map data shows the landcover data for "+p.sliderYear)},3500)},function(e){p.showLoader=!1,y(e.error),console.log(e)})},2e3)},p.getStats=function(){$("#report-tab").html("<h4>Please wait while I generate chart for you...</h4>");var e={classes:p.assemblageLayers,year:p.sliderYear,shape:p.shape,areaSelectFrom:p.areaSelectFrom,areaName:p.areaName,type:"myanmar-plantation"};i.getStats(e).then(function(e){var a=[];for(var o in e)a.push({name:o,y:e[o],color:p.landCoverClassesColor[o]});n.buildChart(a,"report-tab","Landcover types for "+p.sliderYear)},function(e){console.log(e)})};function v(e){void 0===e&&(e="landcover");var a=!0,o=!0;return-1<["polygon","circle","rectangle"].indexOf(p.shape.type)||p.areaSelectFrom||p.areaName||(y("Please draw a polygon or select administrative region before proceding to download!"),a=!1),"primitive"===e&&(p.primitiveIndex||(y("Select a primitive Layer to Download!"),o=!1)),a&&o}p.copyToClipBoard=function(e){void 0===e&&(e="landcover");var a=$("."+e+"CpyBtn"),o=document.queryCommandSupported("copy"),t=a.attr("data-original-title");if(o){var r=document.createElement("textarea");r.value=p[e+"DownloadURL"],document.body.appendChild(r),r.select();try{var n=document.execCommand("copy")?"Copied!":"Whoops, not copied!";a.attr("data-original-title",n).tooltip("show")}catch(e){console.log("Oops, unable to copy")}document.body.removeChild(r),a.attr("data-original-title",t)}else window.prompt("Copy to clipboard: Ctrl+C or Command+C")},p.loadAdminArea=function(e){d.clearDrawing(p.overlays.polygon),d.removeGeoJson(m),p.shape={},p.areaName=e,d.loadGeoJson(m,p.areaSelectFrom,e)};var h=new google.maps.drawing.DrawingManager;p.drawShape=function(e){h.setOptions(d.getDrawingManagerOptions(e)),h.setMap(m)},google.maps.event.addListener(h,"overlaycomplete",function(a){d.clearDrawing(p.overlays.polygon),d.removeGeoJson(m),u();var e=a.overlay;p.overlays.polygon=e,p.shape={};var o=a.type;if("rectangle"===(p.shape.type=o))p.shape.geom=d.getRectangleBoundArray(e.getBounds()),google.maps.event.addListener(e,"bounds_changed",function(){p.shape.geom=d.getRectangleBoundArray(a.overlay.getBounds())});else if("circle"===o)p.shape.center=d.getCircleCenter(e),p.shape.radius=d.getCircleRadius(e),google.maps.event.addListener(e,"radius_changed",function(){p.shape.radius=d.getCircleRadius(a.overlay)}),google.maps.event.addListener(e,"center_changed",function(){p.shape.center=d.getCircleCenter(a.overlay)});else if("polygon"===o){var t=e.getPath();p.shape.geom=d.getPolygonBoundArray(t.getArray()),google.maps.event.addListener(t,"insert_at",function(){var e=a.overlay.getPath();p.shape.geom=d.getPolygonBoundArray(e.getArray())}),google.maps.event.addListener(t,"remove_at",function(){var e=a.overlay.getPath();p.shape.geom=d.getPolygonBoundArray(e.getArray())}),google.maps.event.addListener(t,"set_at",function(){var e=a.overlay.getPath();p.shape.geom=d.getPolygonBoundArray(e.getArray())})}h.setDrawingMode(null)}),m.data.addListener("addfeature",function(e){p.shownGeoJson=e.feature;var a=new google.maps.LatLngBounds,o=e.feature.getGeometry();d.processPoints(o,a.extend,a),m.fitBounds(a)}),m.data.addListener("removefeature",function(e){p.shownGeoJson=null});function f(e){var a=e.target.files;if(1<a.length)y("upload one file at a time"),p.$apply();else{d.removeGeoJson(m);var c=a[0],o=new FileReader;o.readAsText(c),o.onload=function(e){var a,o=e.target.result;if(-1<["application/vnd.google-earth.kml+xml","application/vnd.google-earth.kmz"].indexOf(c.type)){var t;if(window.DOMParser)t=(new DOMParser).parseFromString(o,"text/xml");else(t=new ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(o);a=toGeoJSON.kml(t)}else try{a=JSON.parse(o)}catch(e){y("we only accept kml, kmz and geojson"),p.$apply()}if(a.features&&1===a.features.length||"Feature"===a.type){var r=a.features?a.features[0].geometry:a.geometry;if("Polygon"===r.type){d.addGeoJson(m,a);for(var n=[],i=r.coordinates[0],l=0;l<i.length;l++){var s=[i[l][0].toFixed(2),i[l][1].toFixed(2)];n.push(s)}500<n.length&&(g("Complex geometry will be simplified using the convex hull algorithm!"),p.$apply()),u(),p.shape.type="polygon",p.shape.geom=n}else y("multigeometry and multipolygon not supported yet!"),p.$apply()}else y("multigeometry and multipolygon not supported yet!"),p.$apply()}}}$("#file-input-container #file-input").change(function(e){p.showLoader=!0,p.$apply(),d.clearDrawing(p.overlays.polygon),f(e),$(this).remove(),$("<input type='file' class='hide' id='file-input' accept='.kml,.kmz,.json,.geojson,application/json,application/vnd.google-earth.kml+xml,application/vnd.google-earth.kmz'>").change(f).appendTo($("#file-input-container")),p.showLoader=!1});p.updateAssemblageProduct=function(){p.closeAlert();var e=[];$('input[name="assemblage-checkbox"]').each(function(){$(this).prop("checked")&&e.push($(this).val())});e.length;p.assemblageLayers=n.flattenArrays(e),p.showLoader=!0,d.clearLayer(m,"landcovermap"),d.clearLayer(m,"probabilitymap"),p.initMap(p.sliderYear,"landcovermap"),p.getStats(),p.showProbabilityMap(),d.removeGeoJson(m)},$("#slider-year-selector").ionRangeSlider({skin:"round",grid:!0,min:p.startYear,max:p.endYear,from:p.from_max,from_min:p.from_min,from_max:p.from_max,from_shadow:!0,force_edges:!0,grid_num:p.endYear-p.startYear,prettify_enabled:!1,onFinish:function(e){p.sliderYear!==e.from&&(p.sliderYear=e.from,$("#land-cover-classes-tab").hasClass("active")&&p.updateAssemblageProduct())}}),p.landcoverDownloadURL="",p.showLandcoverDownloadURL=!1,p.showPrimitiveDownloadURL=!1,p.primitiveDownloadURL="",p.getDownloadURL=function(o){if(void 0===o&&(o="landcover"),v(o)){p["show"+n.capitalizeString(o)+"DownloadURL"]=!1,g("Preparing Download Link...");var e={classes:p.assemblageLayers,year:p.sliderYear,shape:p.shape,areaSelectFrom:p.areaSelectFrom,areaName:p.areaName,type:o,index:p.primitiveIndex,serviceType:"myanmar-plantation"};i.getDownloadURL(e).then(function(e){var a;a="Your Download Link is ready!",p.alertContent=a,$(".custom-alert").removeClass("display-none").removeClass("alert-info").removeClass("alert-danger").addClass("alert-success"),p[o+"DownloadURL"]=e.downloadUrl,p["show"+n.capitalizeString(o)+"DownloadURL"]=!0},function(e){y(e.error),console.log(e)})}},p.showLandcoverGDriveFileName=!1,p.showGDriveFileName=function(e){void 0===e&&(e="landcover"),v(e)&&(p["show"+n.capitalizeString(e)+"GDriveFileName"]=!0)},p.hideGDriveFileName=function(e){p["show"+n.capitalizeString(e)+"GDriveFileName"]=!1},p.saveToDrive=function(a){if(void 0===a&&(a="landcover"),v(a)){var e=t($("#"+a+"GDriveFileName").val()||"");g("Please wait while I prepare the download link for you. This might take a while!");var o={classes:p.assemblageLayers,year:p.sliderYear,shape:p.shape,areaSelectFrom:p.areaSelectFrom,areaName:p.areaName,type:a,index:p.primitiveIndex,fileName:e,serviceType:"myanmar-plantation"};i.saveToDrive(o).then(function(e){e.error?(y(e.error),console.log(e.error)):(g(e.info),p.hideGDriveFileName(a),$("#"+a+"GDriveFileName").val(""))},function(e){y(e.error),console.log(e)})}};p.updatePrimitive=function(o){p.showLoader=!0,p.showPrimitiveOpacitySlider=!1;var e={index:o,year:p.sliderYear,shape:p.shape,areaSelectFrom:p.areaSelectFrom,areaName:p.areaName,type:"myanmar-plantation"};i.getPrimitiveMap(e).then(function(e){d.removeGeoJson(m),d.clearLayer(m,"primitivemap");var a=d.getMapType(e.eeMapId,e.eeMapToken,"primitivemap");c("primitivemap",a),r(function(){g("Showing "+function(e){for(var a=p.primitiveClasses.length-1;0<=a;a--)if("string"==typeof e){if(p.primitiveClasses[a].value===e)return p.primitiveClasses[a].name}else if("number"==typeof e&&parseInt(p.primitiveClasses[a].value)===parseInt(e))return p.primitiveClasses[a].name;return""}(o)+" primitive layer for "+p.sliderYear)},3500),p.showPrimitiveOpacitySlider=!0,p.primitiveIndex=o},function(e){p.showLoader=!1,y(e.error),console.log(e)})},p.landcoverOpacity=1,p.showLandcoverOpacityController=!0;$("#landcover-opacity-slider").slider({formatter:function(e){return"Opacity: "+e},tooltip:"none"}).on("slideStart",function(e){p.landcoverOpacity=$(this).data("slider").getValue()}).on("slideStop",function(e){var a=$(this).data("slider").getValue();a!==p.landcoverOpacity&&p.overlays.landcovermap.setOpacity(a)});p.toggleLandcoverMap=function(){$("#landcover-map-checkbox").prop("checked")?(p.showLandcoverOpacityController=!0,p.overlays.landcovermap.setOpacity(p.landcoverOpacity)):(p.showLandcoverOpacityController=!1,p.overlays.landcovermap.setOpacity(0))},p.probabilityOpacity=1,p.showProbabilityOpacityController=!0;$("#probability-opacity-slider").slider({formatter:function(e){return"Opacity: "+e},tooltip:"none"}).on("slideStart",function(e){p.probabilityOpacity=$(this).data("slider").getValue()}).on("slideStop",function(e){var a=$(this).data("slider").getValue();a!==p.probabilityOpacity&&(p.probabilityOpacity=a,p.overlays.probabilitymap.setOpacity(a))});p.showProbabilityMap=function(){var e;e=$("#probability-map-checkbox").prop("checked"),p.showProbabilityOpacityController=!!e,r(function(){var e={year:p.sliderYear,shape:p.shape,areaSelectFrom:p.areaSelectFrom,areaName:p.areaName,type:"myanmar-plantation"};i.getProbabilityMap(e).then(function(e){d.removeGeoJson(m),d.clearLayer(m,"probabilitymap");var a=d.getMapType(e.eeMapId,e.eeMapToken,"probabilitymap"),o=$("#probability-map-checkbox").prop("checked");c("probabilitymap",a),o?(r(function(){g("Showing Probability Map Layer for "+p.sliderYear)},5500),p.showProbabilityLayer=!0):p.overlays.probabilitymap.setOpacity(0)},function(e){y(e.error),console.log(e)})},500)},p.toggleProbabilityMap=function(){$("#probability-map-checkbox").prop("checked")?(p.showProbabilityOpacityController=!0,p.overlays.probabilitymap.setOpacity(p.probabilityOpacity)):(p.showProbabilityOpacityController=!1,p.overlays.probabilitymap.setOpacity(0))}}])}();
!function(){"use strict";angular.module("baseApp").filter("landCoverYearRange",function(){return function(e,a,r){a=parseInt(a),r=parseInt(r);for(var t=a;t<=r;t++)e.push(t);return e}}).controller("sideBySideMapController",["$scope","$sanitize","$timeout","appSettings","CommonService","MapService","LandCoverService",function(i,e,a,o,r,t,n){var s=L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw",{attribution:"Map data &copy; <a href='http://openstreetmap.org'>OpenStreetMap</a> contributors, <a href='http://creativecommons.org/licenses/by-sa/2.0/'>CC-BY-SA</a>, Imagery � <a href='http://mapbox.com'>Mapbox</a>",id:"mapbox.light"}),l=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community"}),y=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"}),c=L.map("map",{center:[16.4,102.93],zoom:5,layers:[y]}),d={"Satellite Imagery":y,Grayscale:s,"Topo Map":l};L.control.layers(d).addTo(c);var p=L.control.sideBySide();i.leftLayer=null,i.rightLayer=null,i.leftLayerYear=null,i.rightLayerYear=null,i.sideBySideControlInitialized=!1,i.landCoverClasses=[],i.assemblageLayers=[];for(var g=0;g<=20;g++)i.assemblageLayers.push(g.toString());i.alertContent="",i.showLoader=!1,i.closeAlert=function(){$(".full-alert").addClass("display-none"),i.alertContent=""};function h(e){void 0===e&&(e="both"),"left"===e?(c.removeLayer(i.leftLayer),i.leftLayer=null):"right"===e?(c.removeLayer(i.rightLayer),i.rightLayer=null):"both"===e&&(c.removeLayer(i.leftLayer),c.removeLayer(i.rightLayer),i.leftLayer=null,i.rightLayer=null),i.sideBySideControlInitialized=!1}i.initMap=function(e,t,a){i.showLoader=!0,"right"===t?i.rightLayerYear=e:"left"===t&&(i.leftLayerYear=e),i.landCoverClasses="v1"===a?o.landCoverClassesV1:"v2"===a?o.landCoverClassesV2:o.landCoverClasses;var r={classes:i.assemblageLayers,year:e,version:a};n.getLandCoverMap(r).then(function(e){var a,r;r=e,i[(a=t)+"Layer"]=L.tileLayer("https://earthengine.googleapis.com/map/"+r.eeMapId+"/{z}/{x}/{y}?token="+r.eeMapToken),i[a+"Layer"].setZIndex(99),i[a+"Layer"].addTo(c),i.showLoader=!1},function(e){var a;a=e.error,i.alertContent=a,$(".full-alert").removeClass("display-none").removeClass("alert-info").removeClass("alert-success").addClass("alert-danger"),console.log(e)})},c.on("layeradd",function(){i.leftLayer&&i.rightLayer&&!i.sideBySideControlInitialized&&(p.setLeftLayers(i.leftLayer),p.setRightLayers(i.rightLayer),p.addTo(c),i.sideBySideControlInitialized=!0)}),i.toggleLeftLayer=function(e){i.leftLayer&&(e?i.leftLayer.setOpacity(1):i.leftLayer.setOpacity(0))},i.toggleRightLayer=function(e){i.rightLayer&&(e?i.rightLayer.setOpacity(1):i.rightLayer.setOpacity(0))},i.updateAssemblageProduct=function(e){i.showLoader=!0,i.closeAlert(),i.assemblageLayers=[],$('input[name="assemblage-checkbox"]').each(function(){$(this).prop("checked")&&i.assemblageLayers.push($(this).val())}),h(),i.initMap(i.leftLayerYear,"left",e),i.initMap(i.rightLayerYear,"right",e)},i.landCoverLeftYearChange=function(e,a){i.leftLayerYear=e,h("left"),i.initMap(i.leftLayerYear,"left",a)},i.landCoverRightYearChange=function(e,a){i.rightLayerYear=e,h("right"),i.initMap(i.rightLayerYear,"right",a)}}])}();
!function(){"use strict";angular.module("baseApp").controller("utilsController",["$rootScope","$scope","appSettings",function(o,e,n){e.menus=n.menus,e.application=n.application,e.footerLinks=n.footerLinks,e.partnersHeader=n.partnersHeader,e.partnersFooter=n.partnersFooter,e.serviceApplicationsCards=n.serviceApplicationsCards,e.publicationLists=n.publicationLists,e.descriptionModalBody="",e.descriptionModalTitle="",e.toggleHandleClass="fa-chevron-up",e.trimDescription=function(o){return String(o).substring(0,200)},e.closeModal=function(){$("#descriptionModal").modal("hide")},e.showModal=function(o,n){e.descriptionModalTitle=o,e.descriptionModalBody=n,$("#descriptionModal").modal("show")},$(".modal-close").click(function(){e.closeModal()}),window.onclick=function(o){o.target===$("#descriptionModal")[0]&&e.closeModal()},$("#carousel").carousel({interval:2e3}),e.toggleFullScreen=function(){$(".map").hasClass("col-md-9")?o.$broadcast("toggleFullScreen",{mapClass:"col-md-12 col-lg-12",sideClass:"col-md-0 col-lg-0"}):o.$broadcast("toggleFullScreen",{mapClass:"col-md-9 col-lg-9",sideClass:"col-md-3 col-lg-3"})},e.showLogoBar=function(){$(".banner-container").removeClass("display-none"),e.toggleHandleClass="fa-chevron-up",$("body").css({"margin-top":"110px"}),$(".nav-side-menu").css({height:"calc(100vh - 110px)"}),$(".map").css({height:"calc(100vh - 110px)"}),$(".tab-tool").css({top:"160px"})},e.hideLogoBar=function(){$(".banner-container").addClass("display-none"),e.toggleHandleClass="fa-chevron-down",$("body").css({"margin-top":"55px"}),$(".nav-side-menu").css({height:"calc(100vh - 55px)"}),$(".map").css({height:"calc(100vh - 55px)"}),$(".tab-tool").css({top:"105px"})},e.toggleLogoBar=function(){$(".banner-container").hasClass("display-none")?e.showLogoBar():e.hideLogoBar()},o.$on("toggleLogoBar",function(o,n){n&&n.show?e.showLogoBar():e.hideLogoBar()}),o.$on("showToggleFullScreenIcon",function(o,n){n&&n.show?e.showToggleFullScreenIcon=!0:e.showToggleFullScreenIcon=!1}),e.showLogoToggleIcon=!0,o.$on("showLogoToggleIcon",function(o,n){n&&n.show?e.showLogoToggleIcon=!0:(e.showLogoToggleIcon=!1,e.hideLogoBar())}),o.$on("changeMenu",function(o,n){n&&n.menus?e.menus=n.menus:console.log("no menu to change!")}),o.$on("changeApplicationName",function(o,n){n&&n.application?e.application=n.application:console.log("no name to change!")}),e.extraBrands=[],o.$on("changeExtraBrands",function(o,n){n&&n.extraBrands?e.extraBrands=n.extraBrands:console.log("no name to change!")})}])}();
!function(){"use strict";angular.module("baseApp").service("CommonService",["appSettings",function(a){var e=this;e.mapClass="col-md-9 col-lg-9",e.sideClass="col-md-3 col-lg-3",e.getAreaVariableOptions=function(t,e){return void 0===e&&(e=!1),"country"===t?e?["Myanmar"]:a.countries:"province"===t?e?a.myanmarProvinces:a.provinces:void 0},e.capitalizeString=function(t){return t.replace(/(^|\s)([a-z])/g,function(t,e,a){return e+a.toUpperCase()})},e.AnalysisToolControl=function(t){var e=document.createElement("div");return e.setAttribute("class","tool-control text-center"),e.setAttribute("id","analysis-tool-control"),e.title="Toogle Tools Visibility",e.innerHTML="<i class='fas fa-times'></i>",t.appendChild(e),e},e.range=function(t,e){for(var a=[],o=t;o<=e;o++)a.push(o);return a},e.getPercent=function(t,e){return(t/e*100).toFixed(2)},e.pad2=function(t){return t<10?"0"+t:t},e.timeFormat=function(t){return t.getFullYear().toString()+e.pad2(t.getMonth()+1)+e.pad2(t.getDate())+e.pad2(t.getHours())+e.pad2(t.getMinutes())+e.pad2(t.getSeconds())},e.isEmptyObject=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},e.objectHasKey=function(t,e){return t.hasOwnProperty(e)},e.flattenArrays=function(t){return[].concat.apply([],t)},e.buildChart=function(t,e,a){Highcharts.chart(e,{chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie"},title:{text:a},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.2f}%</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!1},showInLegend:!0}},series:[{name:"Area",coloyByPoint:!0,data:t}],credits:{enabled:!1},exporting:{buttons:{contextButton:{menuItems:["printChart","separator","downloadPNG","downloadJPEG","downloadPDF","downloadSVG","separator","downloadCSV","downloadXLS"]}}}})},e.buildPieChart=function(t){var e=t.data,a=t.div,o=t.title,i=t.showDataLabels,l=t.exportButtonPosition||"right",n=t.pointFormat,r=t.seriesName,s=t.dataLabelFormat,d={chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie"},title:{text:o},tooltip:{pointFormat:n},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{},showInLegend:!0}},series:[{name:r,coloyByPoint:!0,data:e}],credits:{enabled:!1},exporting:{buttons:{contextButton:{menuItems:["printChart","separator","downloadPNG","downloadJPEG","downloadPDF","downloadSVG","separator","downloadCSV","downloadXLS"],align:l,symbol:"menuball"}}}};i?(d.plotOptions.pie.dataLabels.enabled=!0,d.plotOptions.pie.dataLabels.format=s,d.plotOptions.pie.dataLabels.style={},d.plotOptions.pie.dataLabels.style.color=Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"):d.plotOptions.pie.dataLabels.enabled=!1,Highcharts.chart(a,d)},e.buildColumnChart=function(t){var e=t.categories,a=t.title,o=t.subtitle,i=t.yAxisTitle,l=t.data,n=t.container,r=t.toolTipUnit,s=t.exportButtonPosition||"right",d={chart:{type:"column"},title:{text:a},subtitle:{text:o},xAxis:{categories:e,crosshair:!0},yAxis:{min:0,title:{text:i}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td><td style="padding:0"><b>{point.y:.2f} '+r+"</b></td></tr>",footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0,dataLabels:{enabled:t.dataLabels||!1}}},series:l,credits:{enabled:!1},exporting:{buttons:{contextButton:{menuItems:["printChart","separator","downloadPNG","downloadJPEG","downloadPDF","downloadSVG","separator","downloadCSV","downloadXLS"],align:s,symbol:"menuball"}}}};Highcharts.chart(n,d)},e.createLayerContainer=function(t,e,a,o,i){void 0===i&&(i=!0);var l=document.createElement("div");l.setAttribute("class","leaflet-bar leaflet-html-legend"),l.setAttribute("id","layer-control-"+e);var n=document.createElement("div");n.setAttribute("class","legend-block layer-control");var r=document.createElement("h4");r.setAttribute("class","inline-block-display");var s=document.createElement("div");s.setAttribute("class","legend-caret");var d=document.createElement("span");d.appendChild(document.createTextNode(t[e])),r.appendChild(s),r.appendChild(d);var p=document.createElement("i");p.setAttribute("id","toggle-layer-"+e),i?p.setAttribute("class","far fa-eye float-right"):p.setAttribute("class","far fa-eye-slash float-right"),p.style.cursor="pointer",p.addEventListener("click",function(){$(this).hasClass("fa-eye")?($(this).removeClass("fa-eye").addClass("fa-eye-slash"),$("#layer-opacity-slider-"+e).addClass("display-none-imp"),-1<["polygon","preload"].indexOf(e)?"preload"===e?o.data.forEach(function(t){o.data.setStyle({visible:!1})}):a.setVisible(!1):a.setOpacity(0)):($(this).removeClass("fa-eye-slash").addClass("fa-eye"),$("#layer-opacity-slider-"+e).removeClass("display-none-imp"),-1<["polygon","preload"].indexOf(e)?"preload"===e?o.data.forEach(function(t){o.data.setStyle({visible:!0,fillOpacity:0})}):a.setVisible(!0):a.setOpacity(1))});var c=document.createElement("span");c.setAttribute("class","opacity-slider"),c.setAttribute("id","layer-opacity-slider-"+e);var u=document.createElement("span");u.setAttribute("class","slider-label inline-block-display"),u.appendChild(document.createTextNode("Transparency:"));var m=document.createElement("input");m.setAttribute("id","layer-opacity-slider"),m.setAttribute("class","layer-opacity-slider-"+e),m.setAttribute("data-slider-id","layer-opacity-slider"),m.setAttribute("type","text"),m.setAttribute("data-slider-min","0"),m.setAttribute("data-slider-max","1"),m.setAttribute("data-slider-step","0.1"),c.appendChild(u),c.appendChild(m),i||c.setAttribute("class","display-none-imp"),r.addEventListener("click",function(){$("#layer-tab i#toggle-layer-"+e).hasClass("fa-eye")&&($(this).hasClass("closed")?($(this).removeClass("closed"),$("#layer-opacity-slider-"+e).removeClass("display-none-imp")):($(this).addClass("closed"),$("#layer-opacity-slider-"+e).addClass("display-none-imp")))}),n.appendChild(r),n.appendChild(p),n.appendChild(c),-1<["polygon","preload"].indexOf(e)&&(n.removeChild(c),r.removeChild(s));var y=document.createElement("div");y.appendChild(r),y.appendChild(p);var h=document.createElement("div");return-1===["polygon","preload"].indexOf(e)&&h.appendChild(c),n.appendChild(y),n.appendChild(h),l.appendChild(n),l}}])}();
!function(){"use strict";angular.module("baseApp").service("ForestMonitorService",["$http","$sessionStorage",function(l,t){this.treeCanopyChange=function(a){var e=a.year,t=a.shape,r=a.areaSelectFrom,o=a.areaName,n={method:"POST",url:"/api/forest-monitor/",data:{year:e,treeCanopyDefinition:a.treeCanopyDefinition},params:{action:"tree-canopy"}};if(r&&o)n.data.areaSelectFrom=r,n.data.areaName=o;else{var i=t.type;"rectangle"===i||"polygon"===i?(n.data.shape=i,n.data.geom=t.geom.toString()):"circle"===i&&(n.data.shape=i,n.data.radius=t.radius,n.data.center=t.center.toString())}return l(n).then(function(a){return a.data}).catch(function(a){throw console.log("Error: ",a),a.data})},this.treeHeightChange=function(a){var e=a.year,t=a.shape,r=a.areaSelectFrom,o=a.areaName,n={method:"POST",url:"/api/forest-monitor/",data:{year:e,treeHeightDefinition:a.treeCanopyDefinition},params:{action:"tree-height"}};if(r&&o)n.data.areaSelectFrom=r,n.data.areaName=o;else{var i=t.type;"rectangle"===i||"polygon"===i?(n.data.shape=i,n.data.geom=t.geom.toString()):"circle"===i&&(n.data.shape=i,n.data.radius=t.radius,n.data.center=t.center.toString())}return l(n).then(function(a){return a.data}).catch(function(a){throw console.log("Error: ",a),a.data})},this.primaryForestChange=function(a){var e=a.year,t=a.shape,r=a.areaSelectFrom,o=a.areaName,n={method:"POST",url:"/api/forest-monitor/",data:{year:e},params:{action:"primary-forest"}};if(r&&o)n.data.areaSelectFrom=r,n.data.areaName=o;else{var i=t.type;"rectangle"===i||"polygon"===i?(n.data.shape=i,n.data.geom=t.geom.toString()):"circle"===i&&(n.data.shape=i,n.data.radius=t.radius,n.data.center=t.center.toString())}return l(n).then(function(a){return a.data}).catch(function(a){throw console.log("Error: ",a),a.data})},this.forestGain=function(a){var e=a.startYear,t=a.endYear,r=a.shape,o=a.areaSelectFrom,n=a.areaName,i={method:"POST",url:"/api/forest-monitor/",data:{startYear:e,endYear:t,treeCanopyDefinition:a.treeCanopyDefinition,treeHeightDefinition:a.treeHeightDefinition},params:{action:"forest-gain"}};if(o&&n)i.data.areaSelectFrom=o,i.data.areaName=n;else{var d=r.type;"rectangle"===d||"polygon"===d?(i.data.shape=d,i.data.geom=r.geom.toString()):"circle"===d&&(i.data.shape=d,i.data.radius=r.radius,i.data.center=r.center.toString())}return l(i).then(function(a){return a.data}).catch(function(a){throw console.log("Error: ",a),a.data})},this.forestLoss=function(a){var e=a.startYear,t=a.endYear,r=a.shape,o=a.areaSelectFrom,n=a.areaName,i={method:"POST",url:"/api/forest-monitor/",data:{startYear:e,endYear:t,treeCanopyDefinition:a.treeCanopyDefinition,treeHeightDefinition:a.treeHeightDefinition},params:{action:"forest-loss"}};if(o&&n)i.data.areaSelectFrom=o,i.data.areaName=n;else{var d=r.type;"rectangle"===d||"polygon"===d?(i.data.shape=d,i.data.geom=r.geom.toString()):"circle"===d&&(i.data.shape=d,i.data.radius=r.radius,i.data.center=r.center.toString())}return l(i).then(function(a){return a.data}).catch(function(a){throw console.log("Error: ",a),a.data})},this.forestChange=function(a,e,t,r,o,n,i){var d={method:"POST",url:"/api/forest-monitor/",data:{startYear:a,endYear:e,treeCanopyDefinition:n,treeHeightDefinition:i},params:{action:"forest-change"}};if(r&&o)d.data.areaSelectFrom=r,d.data.areaName=o;else{var s=t.type;"rectangle"===s||"polygon"===s?(d.data.shape=s,d.data.geom=t.geom.toString()):"circle"===s&&(d.data.shape=s,d.data.radius=t.radius,d.data.center=t.center.toString())}return l(d).then(function(a){return a.data}).catch(function(a){throw console.log("Error: ",a),a.data})},this.forestExtend=function(a){var e=a.year,t=a.shape,r=a.areaSelectFrom,o=a.areaName,n={method:"POST",url:"/api/forest-monitor/",data:{year:e,treeCanopyDefinition:a.treeCanopyDefinition,treeHeightDefinition:a.treeHeightDefinition},params:{action:"forest-extend"}};if(r&&o)n.data.areaSelectFrom=r,n.data.areaName=o;else{var i=t.type;"rectangle"===i||"polygon"===i?(n.data.shape=i,n.data.geom=t.geom.toString()):"circle"===i&&(n.data.shape=i,n.data.radius=t.radius,n.data.center=t.center.toString())}return l(n).then(function(a){return a.data}).catch(function(a){throw console.log("Error: ",a),a.data})},this.getDownloadURL=function(a){var e=a.type,t=a.startYear,r=a.endYear,o=a.shape,n=a.areaSelectFrom,i=a.areaName,d={method:"POST",url:"/api/forest-monitor/",data:{startYear:t,endYear:r,treeCanopyDefinition:a.treeCanopyDefinition,treeHeightDefinition:a.treeHeightDefinition},params:{action:"get-download-url",type:e}};if(n&&i)d.data.areaSelectFrom=n,d.data.areaName=i;else{var s=o.type;"rectangle"===s||"polygon"===s?(d.data.shape=s,d.data.geom=o.geom.toString()):"circle"===s&&(d.data.shape=s,d.data.radius=o.radius,d.data.center=o.center.toString())}return l(d).then(function(a){return a.data}).catch(function(a){throw console.log("Error: ",a),a.data})},this.saveToDrive=function(a){var e=a.type,t=a.startYear,r=a.endYear,o=a.fileName,n=a.shape,i=a.areaSelectFrom,d=a.areaName,s={method:"POST",url:"/api/forest-monitor/",data:{startYear:t,endYear:r,fileName:o,treeCanopyDefinition:a.treeCanopyDefinition,treeHeightDefinition:a.treeHeightDefinition},params:{action:"download-to-drive",type:e}};if(i&&d)s.data.areaSelectFrom=i,s.data.areaName=d;else{var c=n.type;"rectangle"===c||"polygon"===c?(s.data.shape=c,s.data.geom=n.geom.toString()):"circle"===c&&(s.data.shape=c,s.data.radius=n.radius,s.data.center=n.center.toString())}return l(s).then(function(a){return a.data}).catch(function(a){throw console.log("Error: ",a),a.data})},this.getStats=function(a){var e=a.year,t=a.startYear,r=a.endYear,o=a.shape,n=a.areaSelectFrom,i=a.areaName,d={method:"POST",url:"/api/forest-monitor/",data:{year:e,startYear:t,endYear:r,treeCanopyDefinition:a.treeCanopyDefinition,treeHeightDefinition:a.treeHeightDefinition},params:{action:"get-stats",type:a.type}};if(n&&i)d.data.areaSelectFrom=n,d.data.areaName=i;else{var s=o.type;"rectangle"===s||"polygon"===s?(d.data.shape=s,d.data.geom=o.geom.toString()):"circle"===s&&(d.data.shape=s,d.data.radius=o.radius,d.data.center=o.center.toString())}return l(d).then(function(a){return a.data}).catch(function(a){throw console.log("Error: ",a),a.data})},this.getUserDownloadInfo=function(){return t.fmsUserDownloadInfo?t.fmsUserDownloadInfo:null},this.setUserDownloadInfo=function(a){t.fmsUserDownloadInfo={};var e={name:a.name,email:a.email,organization:a.organization,purpose:a.purpose};t.fmsUserDownloadInfo=e},this.postUserDownloadInfo=function(a){var e={method:"POST",url:"/api/forest-monitor/download-info/",headers:{"Content-Type":"application/json"},data:{name:a.name,organization:a.organization,email:a.email,usage:a.usage,type:a.type}};return l(e).then(function(a){return a.data}).catch(function(a){throw console.log("Error: ",a),a.data})}}])}();
!function(){"use strict";angular.module("baseApp").service("LandCoverService",["$http","$q",function(v,t){var n=this;n.getLandCoverMap=function(a){var r=a.classes,e=a.year,t=a.shape,n=a.areaSelectFrom,o=a.areaName,i=a.version,m=a.type,c="/api/landcover/";"myanmar-fra"===m?c="/api/myanmar-fra/":"myanmar-ipcc"===m?c="/api/myanmar-ipcc/":"myanmar-national"===m?c="/api/myanmar-national/":"myanmar-plantation"===m&&(c="/api/myanmar-plantation/");var p={method:"POST",url:c,data:{year:e,classes:r.toString()},params:{action:"landcovermap"}};if("v1"===i?p.params.version="v1":"v2"===i&&(p.params.version="v2"),n&&o)p.data.areaSelectFrom=n,p.data.areaName=o;else if(t){var s=t.type;"rectangle"===s||"polygon"===s?(p.data.shape=s,p.data.geom=t.geom.toString()):"circle"===s&&(p.data.shape=s,p.data.radius=t.radius,p.data.center=t.center.toString())}return v(p).then(function(a){return a.data}).catch(function(a){throw console.log("Error: ",a),a.data})},n.getPrimitiveMap=function(a){var r=a.index,e=a.year,t=a.shape,n=a.areaSelectFrom,o=a.areaName,i=a.version,m=a.type,c="/api/landcover/";"myanmar-fra"===m?c="/api/myanmar-fra/":"myanmar-ipcc"===m?c="/api/myanmar-ipcc/":"myanmar-national"===m?c="/api/myanmar-national/":"myanmar-plantation"===m&&(c="/api/myanmar-plantation/");var p={method:"POST",url:c,data:{year:e,index:r},params:{action:"primitive"}};if("v1"===i?p.params.version="v1":"v2"===i&&(p.params.version="v2"),n&&o)p.data.areaSelectFrom=n,p.data.areaName=o;else if(t){var s=t.type;"rectangle"===s||"polygon"===s?(p.data.shape=s,p.data.geom=t.geom.toString()):"circle"===s&&(p.data.shape=s,p.data.radius=t.radius,p.data.center=t.center.toString())}return v(p).then(function(a){return a.data}).catch(function(a){throw console.log("Error: ",a),a.data})},n.getProbabilityMap=function(a){var r=a.year,e=a.shape,t=a.areaSelectFrom,n=a.areaName,o="/api/landcover/";"myanmar-plantation"===a.type&&(o="/api/myanmar-plantation/");var i={method:"POST",url:o,data:{year:r},params:{action:"probability"}};if(t&&n)i.data.areaSelectFrom=t,i.data.areaName=n;else if(e){var m=e.type;"rectangle"===m||"polygon"===m?(i.data.shape=m,i.data.geom=e.geom.toString()):"circle"===m&&(i.data.shape=m,i.data.radius=e.radius,i.data.center=e.center.toString())}return v(i).then(function(a){return a.data}).catch(function(a){throw console.log("Error: ",a),a.data})},n.getCompositeMap=function(a){var r=a.year,e=a.shape,t=a.areaSelectFrom,n=a.areaName,o="/api/landcover/";"myanmar-plantation"===a.type&&(o="/api/myanmar-plantation/");var i={method:"POST",url:o,data:{year:r},params:{action:"get-composite"}};if(t&&n)i.data.areaSelectFrom=t,i.data.areaName=n;else if(e){var m=e.type;"rectangle"===m||"polygon"===m?(i.data.shape=m,i.data.geom=e.geom.toString()):"circle"===m&&(i.data.shape=m,i.data.radius=e.radius,i.data.center=e.center.toString())}return v(i).then(function(a){return a.data}).catch(function(a){throw console.log("Error: ",a),a.data})},n.getStats=function(a){var r=a.classes,e=a.year,t=a.shape,n=a.areaSelectFrom,o=a.areaName,i=a.version,m=a.type,c="/api/landcover/";"myanmar-fra"===m?c="/api/myanmar-fra/":"myanmar-ipcc"===m?c="/api/myanmar-ipcc/":"myanmar-national"===m?c="/api/myanmar-national/":"myanmar-plantation"===m&&(c="/api/myanmar-plantation/");var p={method:"POST",url:c,data:{year:e,classes:r.toString()},params:{action:"get-stats"}};if("v1"===i?p.params.version="v1":"v2"===i&&(p.params.version="v2"),n&&o)p.data.areaSelectFrom=n,p.data.areaName=o;else if(t){var s=t.type;"rectangle"===s||"polygon"===s?(p.data.shape=s,p.data.geom=t.geom.toString()):"circle"===s&&(p.data.shape=s,p.data.radius=t.radius,p.data.center=t.center.toString())}return v(p).then(function(a){return a.data}).catch(function(a){throw console.log("Error: ",a),a.data})},n.getDownloadURL=function(a){var r=a.classes,e=a.year,t=a.shape,n=a.areaSelectFrom,o=a.areaName,i=a.version,m=a.type,c=a.index,p=a.serviceType,s="/api/landcover/";"myanmar-fra"===p?s="/api/myanmar-fra/":"myanmar-ipcc"===p?s="/api/myanmar-ipcc/":"myanmar-national"===p?s="/api/myanmar-national/":"myanmar-plantation"===p&&(s="/api/myanmar-plantation/");var l={method:"POST",url:s,data:{year:e,type:m,classes:r.toString(),index:c},params:{action:"get-download-url"}};if("v1"===i?l.params.version="v1":"v2"===i&&(l.params.version="v2"),n&&o)l.data.areaSelectFrom=n,l.data.areaName=o;else if(t){var d=t.type;"rectangle"===d||"polygon"===d?(l.data.shape=d,l.data.geom=t.geom.toString()):"circle"===d&&(l.data.shape=d,l.data.radius=t.radius,l.data.center=t.center.toString())}return v(l).then(function(a){return a.data}).catch(function(a){throw console.log("Error: ",a),a.data})},n.saveToDrive=function(a){var r=a.classes,e=a.year,t=a.shape,n=a.areaSelectFrom,o=a.areaName,i=a.version,m=a.type,c=a.index,p=a.serviceType,s=a.fileName,l="/api/landcover/";"myanmar-fra"===p?l="/api/myanmar-fra/":"myanmar-ipcc"===p?l="/api/myanmar-ipcc/":"myanmar-national"===p?l="/api/myanmar-national/":"myanmar-plantation"===p&&(l="/api/myanmar-plantation/");var d={method:"POST",url:l,data:{year:e,type:m,classes:r.toString(),fileName:s,index:c},params:{action:"download-to-drive"}};if("v1"===i?d.params.version="v1":"v2"===i&&(d.params.version="v2"),n&&o)d.data.areaSelectFrom=n,d.data.areaName=o;else if(t){var y=t.type;"rectangle"===y||"polygon"===y?(d.data.shape=y,d.data.geom=t.geom.toString()):"circle"===y&&(d.data.shape=y,d.data.radius=t.radius,d.data.center=t.center.toString())}return v(d).then(function(a){return a.data}).catch(function(a){throw console.log("Error: ",a),a.data})},n.getColumnStatData=function(r,a){var e=[];return a.forEach(function(a){r.year=a,e.push(n.getStats(r))}),t.all(e).then(function(a){return a})}}])}();
!function(){"use strict";angular.module("baseApp").service("MapService",function(){var a=this;a.DEFAULT_ZOOM=5,a.MAX_ZOOM=25,a.DEFAULT_CENTER={lng:102.93,lat:16.4},a.CENTER=[16.4,102.93],a.getMapBoxLeafletLayer=function(){return L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw",{attribution:"Map data &copy; <a href='http://openstreetmap.org'>OpenStreetMap</a> contributors, <a href='http://creativecommons.org/licenses/by-sa/2.0/'>CC-BY-SA</a>, Imagery � <a href='http://mapbox.com'>Mapbox</a>",id:"mapbox.light"})},a.getEsriWorldTopoLeafletLayer=function(){return L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community"})},a.getEsriWorldImageryLeafletLayer=function(){return L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"})},a.initLeafletMap=function(e,t){var o={center:a.CENTER,zoom:a.DEFAULT_ZOOM,layers:[a.getMapBoxLeafletLayer()]};return L.map(e,$.extend(o,t))},a.init=function(e,t,o){var n={center:t&&e?{lng:e,lat:t}:a.DEFAULT_CENTER,zoom:o||a.DEFAULT_ZOOM,maxZoom:a.MAX_ZOOM,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.TOP_CENTER},mapTypeId:"terrain",fullscreenControl:!0,fullscreenControlOptions:{position:google.maps.ControlPosition.LEFT_TOP},zoomControlOptions:{position:google.maps.ControlPosition.LEFT_TOP},scaleControl:!0,streetViewControl:!1,streetViewControlOptions:{position:google.maps.ControlPosition.LEFT_TOP}};return new google.maps.Map(document.getElementById("map"),n)},a.loadGeoJson=function(e,t,o){o&&(e.data.loadGeoJson("/static/data/"+t+"/"+o+".json"),e.data.setStyle({visible:!0,fillOpacity:0,strokeColor:"black",clickable:!1}))},a.addGeoJson=function(e,t){e.data.addGeoJson(t),e.data.setStyle({visible:!0,fillOpacity:0,strokeColor:"black",clickable:!1})},a.removeGeoJson=function(t){t.data.forEach(function(e){t.data.remove(e)})},a.processPoints=function(e,t,o){e instanceof google.maps.LatLng?t.call(o,e):e instanceof google.maps.Data.Point?t.call(o,e.get()):e.getArray().forEach(function(e){a.processPoints(e,t,o)})},a.clearLayer=function(o,n){o.overlayMapTypes.forEach(function(e,t){e&&e.name===n&&o.overlayMapTypes.removeAt(t)})},a.clearDrawing=function(e){e&&e.setMap(null)},a.getMapType=function(n,a,e){var t={getTileUrl:function(e,t){var o="https://earthengine.googleapis.com/map/";return o+=[n,t,e.x,e.y].join("/"),o+="?token="+a},tileSize:new google.maps.Size(256,256),opacity:1,name:e};return new google.maps.ImageMapType(t)},a.getPolygonBoundArray=function(e){for(var t=[],o=0;o<e.length;o++){var n=[e[o].lng().toFixed(2),e[o].lat().toFixed(2)];t.push(n)}return t},a.computePolygonArea=function(e){return google.maps.geometry.spherical.computeArea(e)/1e6},a.getRectangleBoundArray=function(e){var t=e.getNorthEast(),o=e.getSouthWest();return[Number(t.lng().toFixed(2)),Number(t.lat().toFixed(2)),Number(o.lng().toFixed(2)),Number(o.lat().toFixed(2))]},a.computeRectangleArea=function(e){if(!e)return 0;var t=e.getSouthWest(),o=e.getNorthEast(),n=new google.maps.LatLng(t.lat(),t.lng()),a=new google.maps.LatLng(o.lat(),o.lng()),r=new google.maps.LatLng(t.lat(),o.lng()),i=new google.maps.LatLng(o.lat(),t.lng());return google.maps.geometry.spherical.computeArea([a,i,n,r])/1e6},a.getCircleCenter=function(e){return[e.getCenter().lng().toFixed(2),e.getCenter().lat().toFixed(2)]},a.getCircleRadius=function(e){return e.getRadius().toFixed(2)},a.computeCircleArea=function(e){return Math.PI*Math.pow(e.getRadius()/1e3,2)},a.getDrawingManagerOptions=function(e){if(!e)return{};var t;"rectangle"===e?t="rectangleOptions":"circle"===e?t="circleOptions":"polygon"===e&&(t="polygonOptions");var o={drawingControl:!1};return o.drawingMode=e,o[t]={strokeColor:"#ff0000",strokeWeight:5,fillColor:"yellow",fillOpacity:0,editable:!0},o}})}();